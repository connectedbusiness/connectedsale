define(["backbone","base64","shared/global"],function(n,e,t){var o=function(n,e){var t=n+":"+e,o=Base64.encode(t);return"Basic "+o},i=function(n){var e=o(t.Username,t.Password);n.setRequestHeader("Authorization",e),t.HubConnectionID&&n.setRequestHeader("HubConnectionID",t.HubConnectionID)},r=n.Model.extend({save:function(n,e,t){this.trigger("before-save"),this.doSave.apply(this,arguments)},doSave:function(e,o,r){o||(o={}),null==o.timeout&&(o.timeout=3e5),o.modelcid=this.cid,t.HubConnectionID=o.connectionID?o.connectionID:null,o.beforeSend=i;var c=this.CheckInternet();if("No network connection"==c){var a=n.Model.prototype.save.call(this,e,o);return a.abort(),a}t.isBrowserMode||this.IntializeNetworkIndicator(),n.Model.prototype.save.call(this,e,o)},fetch:function(e){e||(e={}),null==e.timeout&&(e.timeout=3e4),e.beforeSend=i;var o=this.CheckInternet();if("No network connection"==o){var r=n.Model.prototype.fetch.call(this,e);return r.abort(),r}t.isBrowserMode||this.IntializeNetworkIndicator(),n.Model.prototype.fetch.call(this,e)},CheckInternet:function(){if(void 0!=navigator.connection&&void 0!=navigator.connection.type){var n=navigator.connection.type,e={};return e[Connection.UNKNOWN]="Unknown connection",e[Connection.ETHERNET]="Ethernet connection",e[Connection.WIFI]="WiFi connection",e[Connection.CELL_2G]="Cell 2G connection",e[Connection.CELL_3G]="Cell 3G connection",e[Connection.CELL_4G]="Cell 4G connection",e[Connection.NONE]="No network connection",this.connectionType=e[n]}return t.isBrowserMode=!0,this.connectionType="Browser Mode"},RequestError:function(n,e,t){switch(n.statusText){case"timeout":navigator.notification.alert("Request timed out. Check internet settings and try again.",null,e,"OK",!0);break;case"abort":navigator.notification.alert("Unable to process request. Please check your internet settings.",null,e,"OK",!0);break;default:t||(t="The remote server returned an error."),navigator.notification.alert(t,null,e,"OK",!0)}},IntializeNetworkIndicator:function(){null!=this.showIndicator&&1!=this.showIndicator||(window.plugins?(window.plugins.cbNetworkActivity=cordova.require(t.Plugins.ActivityIndicator),window.plugins.cbNetworkActivity.ShowIndicator()):window.plugins={})},SetShowIndicator:function(n){this.showIndicator=n}});return r});