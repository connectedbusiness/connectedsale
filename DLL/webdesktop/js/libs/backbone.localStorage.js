!function(t,e){"function"==typeof define&&define.amd?define(["backbone"],function(r){return e(r||t.Backbone)}):e(Backbone)}(this,function(t){function e(){return(65536*(1+Math.random())|0).toString(16).substring(1)}function r(){return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}return t.LocalStorage=function(t){this.name=t;var e=this.localStorage().getItem(this.name);this.records=e&&e.split(",")||[]},_.extend(t.LocalStorage.prototype,{save:function(){this.localStorage().setItem(this.name,this.records.join(","),{silent:!0})},create:function(t){return t.id||(t.id=r(),t.set(t.idAttribute,t.id)),this.localStorage().setItem(this.name+"-"+t.id,JSON.stringify(t)),this.records.push(t.id.toString()),this.save(),this.find(t)},update:function(t){return this.localStorage().setItem(this.name+"-"+t.id,JSON.stringify(t)),_.include(this.records,t.id.toString())||this.records.push(t.id.toString()),this.save(),this.find(t)},find:function(t){return this.jsonData(this.localStorage().getItem(this.name+"-"+t.id))},findAll:function(){return _(this.records).chain().map(function(t){return this.jsonData(this.localStorage().getItem(this.name+"-"+t))},this).compact().value()},destroy:function(t){return!t.isNew()&&(this.localStorage().removeItem(this.name+"-"+t.id),this.records=_.reject(this.records,function(e){return e===t.id.toString()}),this.save(),t)},localStorage:function(){return localStorage},jsonData:function(t){return t&&JSON.parse(t)}}),t.LocalStorage.sync=function(e,r,n){var o,i,c=r.localStorage||r.collection.localStorage,a=$.Deferred&&$.Deferred();try{switch(e){case"read":o=void 0!=r.id?c.find(r):c.findAll();break;case"create":o=c.create(r);break;case"update":o=c.update(r);break;case"delete":o=c.destroy(r)}}catch(s){i=s.code===DOMException.QUOTA_EXCEEDED_ERR&&0===window.localStorage.length?"Private browsing is unsupported":s.message}return o?(r.trigger("sync",r,o,n),n&&n.success&&("0.9.10"===t.VERSION?n.success(r,o,n):n.success(o)),a&&a.resolve(o)):(i=i?i:"Record Not Found",r.trigger("error",r,i,n),n&&n.error&&("0.9.10"===t.VERSION?n.error(r,i,n):n.error(i)),a&&a.reject(i)),n&&n.complete&&n.complete(o),a&&a.promise()},t.ajaxSync=t.sync,t.getSyncMethod=function(e){return e.localStorage||e.collection&&e.collection.localStorage?t.LocalStorage.sync:t.ajaxSync},t.sync=function(e,r,n){return t.getSyncMethod(r).apply(this,[e,r,n])},t.LocalStorage});