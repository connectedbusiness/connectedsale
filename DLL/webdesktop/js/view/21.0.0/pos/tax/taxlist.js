define(["jquery","mobile","underscore","backbone","shared/global","shared/service","shared/method","shared/shared","model/base","collection/base","./tax","text!template/21.0.0/pos/tax/taxlist.tpl.html","js/libs/iscroll.js"],function(e,t,i,o,s,n,l,r,c,a,h,d){return o.View.extend({template:i.template(d),events:{"click #done":"done"},done:function(e){e.preventDefault(),this.taxCode&&this.processRecalculate(),this.close()},initialize:function(){this.$el.html(this.template),this.model||(this.model=new c),this.collection||(this.collection=new a),this.list=this.$el.find("#taxListContainer")},render:function(){return this.listener(),this.loadTaxList(),e("#main-transaction-blockoverlay").show(),this},listener:function(){this.collection.on("reset",this.renderAll,this),this.collection.on("selected",this.changeTaxCode,this)},close:function(){console.log("Closing and removing event bindings",this),e("#main-transaction-blockoverlay").hide(),this.unbind(),this.remove()},loadTaxList:function(){var e=s.Preference.TaxByLocation;e?this.model.url=s.ServiceUrl+n.CUSTOMER+"TaxSchemeLookupByLocation/"+s.Preference.CompanyCountry+"/"+s.ShipTo.WarehouseCode:this.model.url=s.ServiceUrl+n.CUSTOMER+l.TAXSCHEMELOOKUP+100+"/"+s.Preference.CompanyCountry,this.model.save(null,{success:function(e,t,i){return s.isBrowserMode||window.plugins.cbNetworkActivity.HideIndicator(),r.IsNullOrWhiteSpace(t.ErrorMessage)?void this.collection.reset(t.SystemTaxSchemes):void navigator.notification.alert("Fetching Tax Response : "+t.ErrorMessage,null,"Error","OK")}.bind(this),error:function(e,t,i){console.log(t,i)}.bind(this)})},renderAll:function(){this.collection.each(this.renderOne,this),this.list.listview().listview("refresh"),this.LoadScroll()},renderOne:function(e){var t=new h({model:e});t.isSelected?this.list.prepend(t.render().el):this.list.append(t.render().el),this.LoadScroll()},LoadScroll:function(){s.isBrowserMode?r.UseBrowserScroll("#tax-inner"):this.myScroll?this.myScroll.refresh():this.myScroll=new iScroll("tax-inner")},changeTaxCode:function(e){this.taxCode=e.get("TaxCode")},processRecalculate:function(){console.log(this.taxCode),window.sessionStorage.setItem("selected_taxcode",this.taxCode),this.trigger("changeTaxCode",this.taxCode)}})});