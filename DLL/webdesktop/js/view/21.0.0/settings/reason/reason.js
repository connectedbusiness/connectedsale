define(["jquery","mobile","underscore","backbone","shared/global","shared/method","shared/service","collection/preferences","text!template/21.0.0/settings/reason/reason.tpl.html","js/libs/ui.checkswitch.min.js"],function(e,s,n,t,i,o,r,a,c){var l=t.View.extend({_template:n.template(c),events:{"tap #IsReasonDiscount, #IsReasonReturns, #IsReasonItemVoid, #IsReasonTransactionVoid":"Chkbox_click"},initialize:function(){this.render()},render:function(){this.FetchPreference()},InitializeDisplay:function(){this.$el.html(this._template(this.preferenceCollection.at(0).toJSON())),this.ToggleCheckboxes(),this.$("#settings-reason").trigger("create")},InitializePreferences:function(){this.preferences||(this.preferences=new a)},InitializePreferenceCollection:function(){this.preferenceCollection||(this.preferenceCollection=new a)},FetchPreference:function(){var e=this;this.InitializePreferences(),this.InitializePreferenceCollection(),this.preferences.url=i.ServiceUrl+r.POS+o.GETPREFERENCEBYWORKSTATION+i.POSWorkstationID,this.preferences.fetch({success:function(s,n){e.ResetPreferenceCollection(n.Preference)},error:function(e,s,n){i.isBrowserMode||window.plugins.cbNetworkActivity.HideIndicator(),e.RequestError(s,"Error Retrieving Workstation Preference")}})},ResetPreferenceCollection:function(e){i.isBrowserMode||window.plugins.cbNetworkActivity.HideIndicator(),this.preferenceCollection.reset(e),this.InitializeDisplay()},Save:function(){if(this.preferenceCollection&&0!==this.preferenceCollection.length&&this.preferences&&0!==this.preferences.length){this.UpdatePreference();var e=this,s=this.preferences.at(0);s.set({Preference:this.preferenceCollection.at(0)}),s.url=i.ServiceUrl+r.POS+o.UPDATEPREFERENCE,s.save(null,{success:function(s,n){e.SaveCompleted()},error:function(e,s,n){e.RequestError(s,"Error Saving Reason Code Preference")}})}},SaveCompleted:function(){i.isBrowserMode||window.plugins.cbNetworkActivity.HideIndicator(),this.trigger("SaveCompleted",this)},ToggleCheckboxes:function(){var e=this,s=this.preferenceCollection.at(0),t=["IsReasonDiscount","IsReasonTransactionVoid","IsReasonItemVoid","IsReasonReturns"];n.each(t,function(n){switch(n){case"IsReasonDiscount":e.isReasonDiscount=s.attributes.IsReasonDiscount;break;case"IsReasonTransactionVoid":e.isReasonTransactionVoid=s.attributes.IsReasonTransactionVoid;break;case"IsReasonItemVoid":e.isReasonItemVoid=s.attributes.IsReasonItemVoid;break;case"IsReasonReturns":e.isReasonReturns=s.attributes.IsReasonReturns}s.get(n)?e.SetChkState(n,!0):e.SetChkState(n,!1)})},Chkbox_click:function(e){e.preventDefault();var s="#"+e.currentTarget.id,n=this.GetCheckState(s);this.SetChkState(e.currentTarget.id,!n)},GetCheckState:function(s){return!!e(s).hasClass("icon-ok-sign")},ToggleCheckbox:function(s,n){n?(e("#"+s).addClass("icon-ok-sign").css("color",""),e("#"+s).removeClass("icon-circle-blank")):(e("#"+s).addClass("icon-circle-blank").css("color","#DADADA"),e("#"+s).removeClass("icon-ok-sign"))},SetChkState:function(e,s){var n=this;switch(e){case"IsReasonDiscount":n.isReasonDiscount=s;break;case"IsReasonTransactionVoid":n.isReasonTransactionVoid=s;break;case"IsReasonItemVoid":n.isReasonItemVoid=s;break;case"IsReasonReturns":n.isReasonReturns=s}n.ToggleCheckbox(e,s)},UpdatePreference:function(){var e=this,s=e.preferenceCollection.at(0),t=["IsReasonDiscount","IsReasonReturns","IsReasonItemVoid","IsReasonTransactionVoid"];n.each(t,function(n){var t=!1;switch(n){case"IsReasonDiscount":t=e.isReasonDiscount,s.set({IsReasonDiscount:t});break;case"IsReasonReturns":t=e.isReasonReturns,s.set({IsReasonReturns:t});break;case"IsReasonItemVoid":t=e.isReasonItemVoid,s.set({IsReasonItemVoid:t});break;case"IsReasonTransactionVoid":t=e.isReasonTransactionVoid,s.set({IsReasonTransactionVoid:t})}}),e.preferenceCollection.reset(s)}});return l});