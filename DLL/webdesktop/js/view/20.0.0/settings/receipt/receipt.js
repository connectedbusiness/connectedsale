define(["jquery","mobile","underscore","backbone","shared/global","shared/service","shared/method","shared/shared","model/receipt","model/printer","collection/receipts","collection/preferences","view/20.0.0/settings/receipt/print/printsetting","view/20.0.0/settings/receipt/typelist/receipttypelist","view/20.0.0/settings/modal/modal","text!template/20.0.0/settings/receipt/receipt.tpl.html","js/libs/iscroll.js","js/libs/ui.checkswitch.min.js"],function(e,t,r,i,o,n,p,a,c,s,d,l,R,P,C,u){var h=i.View.extend({_template:r.template(u),events:{"tap #printer-settings":"showPrintSettings","change #AutoPrintReceipt":"AutoPrintReceipt_toggled","tap #sale-receipt":"SaleReceiptTapped","tap #order-receipt":"OrderReceiptTapped","tap #quote-receipt":"QuoteReceiptTapped","tap #return-receipt":"ReturnReceiptTapped","tap #credit-card-receipt":"CreditCardReceiptTapped","tap #sale-payment-receipt":"SalePaymentReceiptTapped","tap #pick-note-receipt":"PickNoteTapped","tap #z-tape-report":"ZTapeTapped","tap #x-tape-report":"XTapeTapped","tap #sale-receipt2":"SaleReceipt2Tapped","tap #order-receipt2":"OrderReceipt2Tapped","tap #quote-receipt2":"QuoteReceipt2Tapped","tap #return-receipt2":"ReturnReceipt2Tapped","tap #credit-card-receipt2":"CreditCardReceipt2Tapped","tap #sale-payment-receipt2":"SalePaymentReceipt2Tapped","tap #pick-note-receipt2":"PickNote2Tapped","tap #default-printer":"DefaultPrinterTapped","tap #invoice-report-printer":"InvoiceReportPrinterTapped","tap #invoice-report-printer2":"InvoiceReportPrinter2Tapped","tap #order-report-printer":"OrderReportPrinterTapped","tap #quote-report-printer":"QuoteReportPrinterTapped","tap #return-report-printer":"ReturnReportPrinterTapped","tap #credit-card-report-printer":"CreditCardReportPrinterTapped","tap #sale-payment-report-printer":"SalePaymentReportPrinterTapped","tap #pick-note-report-printer":"PickNoteReportPrinterTapped","change #InvoiceReceiptCopies, #OrderReceiptCopies, #QuoteReceiptCopies, #ReturnReceiptCopies, #CreditCardReceiptCopies, #SalePaymentReceiptCopies, #PickNoteReceiptCopies":"TextNumber_Changed","change #InvoiceReceiptCopies2, #OrderReceiptCopies2, #QuoteReceiptCopies2, #ReturnReceiptCopies2, #CreditCardReceiptCopies2, #SalePaymentReceiptCopies2, #PickNoteReceiptCopies2":"TextNumber_Changed","tap #IsSinglePageTransactionReceipt, #ShowPrintOptions, #AutoEmailReceipt, #AutoPrintReceipt":"Chkbox_click","tap #InvoiceReceiptAutoPrint":"Chkbox_click"},SaleReceiptTapped:function(e){e.preventDefault(),this.UpdatePreference(),this.InitializeReceiptModel("InvoiceReportCode")},OrderReceiptTapped:function(e){e.preventDefault(),this.UpdatePreference(),this.InitializeReceiptModel("OrderReportCode")},QuoteReceiptTapped:function(e){e.preventDefault(),this.UpdatePreference(),this.InitializeReceiptModel("QuoteReportCode")},ReturnReceiptTapped:function(e){e.preventDefault(),this.UpdatePreference(),this.InitializeReceiptModel("ReturnReportCode")},CreditCardReceiptTapped:function(e){e.preventDefault(),this.UpdatePreference(),this.InitializeReceiptModel("CreditCardReportCode")},SalePaymentReceiptTapped:function(e){e.preventDefault(),this.UpdatePreference(),this.InitializeReceiptModel("SalePaymentReportCode")},PickNoteTapped:function(e){e.preventDefault(),this.UpdatePreference(),this.InitializeReceiptModel("PickNoteReportCode")},ZTapeTapped:function(e){e.preventDefault(),this.UpdatePreference(),this.InitializeReceiptModel("ZTapeReportCode")},XTapeTapped:function(e){e.preventDefault(),this.UpdatePreference(),this.InitializeReceiptModel("XTapeReportCode")},SaleReceipt2Tapped:function(e){e.preventDefault(),this.UpdatePreference(),this.InitializeReceiptModel("InvoiceReportCode2")},OrderReceipt2Tapped:function(e){e.preventDefault(),this.UpdatePreference(),this.InitializeReceiptModel("OrderReportCode2")},QuoteReceipt2Tapped:function(e){e.preventDefault(),this.UpdatePreference(),this.InitializeReceiptModel("QuoteReportCode2")},ReturnReceipt2Tapped:function(e){e.preventDefault(),this.UpdatePreference(),this.InitializeReceiptModel("ReturnReportCode2")},CreditCardReceipt2Tapped:function(e){e.preventDefault(),this.UpdatePreference(),this.InitializeReceiptModel("CreditCardReportCode2")},SalePaymentReceipt2Tapped:function(e){e.preventDefault(),this.UpdatePreference(),this.InitializeReceiptModel("SalePaymentReportCode2")},PickNote2Tapped:function(e){e.preventDefault(),this.UpdatePreference(),this.InitializeReceiptModel("PickNoteReportCode2")},DefaultPrinterTapped:function(e){e.preventDefault(),this.UpdatePreference(),this.ShowPrinterList("DefaultPrinter")},InvoiceReportPrinterTapped:function(e){e.preventDefault(),this.UpdatePreference(),this.ShowPrinterList("InvoiceReportPrinter")},InvoiceReportPrinter2Tapped:function(e){e.preventDefault(),this.UpdatePreference(),this.ShowPrinterList("InvoiceReportPrinter2")},OrderReportPrinterTapped:function(e){e.preventDefault(),this.UpdatePreference(),this.ShowPrinterList("OrderReportPrinter")},QuoteReportPrinterTapped:function(e){e.preventDefault(),this.UpdatePreference(),this.ShowPrinterList("QuoteReportPrinter")},ReturnReportPrinterTapped:function(e){e.preventDefault(),this.UpdatePreference(),this.ShowPrinterList("ReturnReportPrinter")},CreditCardReportPrinterTapped:function(e){e.preventDefault(),this.UpdatePreference(),this.ShowPrinterList("CreditCardReportPrinter")},SalePaymentReportPrinterTapped:function(e){e.preventDefault(),this.UpdatePreference(),this.ShowPrinterList("SalePaymentReportPrinter")},PickNoteReportPrinterTapped:function(e){e.preventDefault(),this.UpdatePreference(),this.ShowPrinterList("PickNoteReportPrinter")},Chkbox_click:function(e){e.preventDefault();var t="#"+e.currentTarget.id,r=this.GetCheckState(t);this.SetChkState(e.currentTarget.id,!r)},InitializeReceiptModel:function(e){this.receiptCollection=new d,this.receiptCollection.on("selected",this.UpdateReportCodeSelected,this),this.lookupReportMode=e,this.receiptModel;var t=100;this.receiptModel=new c,this.receiptModel.url=o.ServiceUrl+n.POS+p.REPORTCODELOOKUP+e+"/"+t,this.RetrieveReportCodes()},ShowPrinterList:function(t){if(printerTool){var r=this;printerTool.getPrinters().then(function(i){var o=i.map(function(e){var i=new s;return i.on("selected",r.UpdateDefaultPrinter,r),i.set({Printer:e,mode:t}),i});if(o&&o.length>0){r.SetSelectedPage("DefaultPrinter");var n,p=r.preferenceCollection.at(0);switch(t){case"DefaultPrinter":n=p.get("DefaultPrinter");break;case"InvoiceReportPrinter":n=p.get("InvoiceReportPrinter");break;case"InvoiceReportPrinter2":n=p.get("InvoiceReportPrinter2");break;case"CreditCardReportPrinter":n=p.get("CreditCardReportPrinter");break;case"OrderReportPrinter":n=p.get("OrderReportPrinter");break;case"PickNoteReportPrinter":n=p.get("PickNoteReportPrinter");break;case"QuoteReportPrinter":n=p.get("QuoteReportPrinter");break;case"ReturnReportPrinter":n=p.get("ReturnReportPrinter");break;case"SalePaymentReportPrinter":n=p.get("SalePaymentReportPrinter")}r.settingsModal=new C({el:e("#settings-modal-container"),collection:o,preferencetype:"DefaultPrinter",defaultPrinter:n})}else navigator.notification.alert("There are no printers installed in this machine.",null,"No Printers Found","OK")})}},RetrieveReportCodes:function(){var e=this,t=" ";this.receiptModel.set({Criteria:t}),this.receiptModel.save(null,{success:function(t,r){o.isBrowserMode||window.plugins.cbNetworkActivity.HideIndicator(),e.receiptCollection.reset(r.ReportViews),e.ValidateCollection(e.receiptCollection)},error:function(e,t,r){o.isBrowserMode||window.plugins.cbNetworkActivity.HideIndicator(),e.RequestError(t,"Error Retrieving Report Codes")}})},ValidateCollection:function(e){0===e.length?(console.log("No Data Found!"),navigator.notification.alert("No Report found.",null,"No Report Found","OK")):this.ShowReceiptTypePage(e)},ShowReceiptTypePage:function(t){_selectedReportCode=this.GetSelectedReportCode(),this.SetSelectedPage("ReceiptTypeListPage"),this.settingsModal=new C({el:e("#settings-modal-container"),collection:t,preferencetype:"Receipt",selectedReport:_selectedReportCode})},UpdateReportCodeSelected:function(e){if(this.preferenceCollection&&0!==this.preferenceCollection.length&&this.preferences&&0!==this.preferences.length){_prevReportCode=this.GetSelectedReportCode(),_prevReportCode!==e.get("ReportCode")&&(this.AssignChangesToPreference(e),this.Save(),this.InitializeDisplay(),this.CloseModal())}},UpdateDefaultPrinter:function(e){if(this.preferenceCollection&&0!==this.preferenceCollection.length&&this.preferences&&0!==this.preferences.length){var t,r=this.preferenceCollection.at(0),i=e.get("Printer"),o=e.attributes.mode;switch(o){case"DefaultPrinter":t=r.get("DefaultPrinter");break;case"InvoiceReportPrinter":t=r.get("InvoiceReportPrinter");break;case"InvoiceReportPrinter2":t=r.get("InvoiceReportPrinter2");break;case"CreditCardReportPrinter":t=r.get("CreditCardReportPrinter");break;case"OrderReportPrinter":t=r.get("OrderReportPrinter");break;case"PickNoteReportPrinter":t=r.get("PickNoteReportPrinter");break;case"QuoteReportPrinter":t=r.get("QuoteReportPrinter");break;case"ReturnReportPrinter":t=r.get("ReturnReportPrinter");break;case"SalePaymentReportPrinter":t=r.get("SalePaymentReportPrinter")}if(i!=t){switch(o){case"DefaultPrinter":r.set({DefaultPrinter:i});break;case"InvoiceReportPrinter":r.set({InvoiceReportPrinter:i});break;case"InvoiceReportPrinter2":r.set({InvoiceReportPrinter2:i});break;case"CreditCardReportPrinter":r.set({CreditCardReportPrinter:i});break;case"OrderReportPrinter":r.set({OrderReportPrinter:i});break;case"PickNoteReportPrinter":r.set({PickNoteReportPrinter:i});break;case"QuoteReportPrinter":r.set({QuoteReportPrinter:i});break;case"ReturnReportPrinter":r.set({ReturnReportPrinter:i});break;case"SalePaymentReportPrinter":r.set({SalePaymentReportPrinter:i})}this.Save(),this.InitializeDisplay(),this.CloseModal()}}},CloseModal:function(){null!=this.settingsModal&&this.settingsModal.close()},AssignChangesToPreference:function(e){var t=this.preferenceCollection.at(0);e.get("ReportCode");switch(this.lookupReportMode){case"InvoiceReportCode":t.set({InvoiceReportCode:e.get("ReportCode"),InvoiceReportName:e.get("ReportName")});break;case"ReturnReportCode":t.set({ReturnReportCode:e.get("ReportCode"),ReturnReportName:e.get("ReportName")});break;case"OrderReportCode":t.set({OrderReportCode:e.get("ReportCode"),OrderReportName:e.get("ReportName")});break;case"QuoteReportCode":t.set({QuoteReportCode:e.get("ReportCode"),QuoteReportName:e.get("ReportName")});break;case"CreditCardReportCode":t.set({CreditCardReportCode:e.get("ReportCode"),CreditCardReportName:e.get("ReportName")});break;case"SalePaymentReportCode":t.set({SalePaymentReportCode:e.get("ReportCode"),SalePaymentReportName:e.get("ReportName")});break;case"PickNoteReportCode":t.set({PickNoteReportCode:e.get("ReportCode"),PickNoteReportName:e.get("ReportName")});break;case"XTapeReportCode":t.set({XTapeReportCode:e.get("ReportCode"),XTapeReportName:e.get("ReportName")});break;case"ZTapeReportCode":t.set({ZTapeReportCode:e.get("ReportCode"),ZTapeReportName:e.get("ReportName")});case"DefaultPrinter":t.set({DefaultPrinter:e.get("ReportName")});break;case"InvoiceReportCode2":t.set({InvoiceReportCode2:e.get("ReportCode"),InvoiceReportName2:e.get("ReportName")});break;case"ReturnReportCode2":t.set({ReturnReportCode2:e.get("ReportCode"),ReturnReportName2:e.get("ReportName")});break;case"OrderReportCode2":t.set({OrderReportCode2:e.get("ReportCode"),OrderReportName2:e.get("ReportName")});break;case"QuoteReportCode2":t.set({QuoteReportCode2:e.get("ReportCode"),QuoteReportName2:e.get("ReportName")});break;case"CreditCardReportCode2":t.set({CreditCardReportCode2:e.get("ReportCode"),CreditCardReportName2:e.get("ReportName")});break;case"SalePaymentReportCode2":t.set({SalePaymentReportCode2:e.get("ReportCode"),SalePaymentReportName2:e.get("ReportName")});break;case"PickNoteReportCode2":t.set({PickNoteReportCode2:e.get("ReportCode"),PickNoteReportName2:e.get("ReportName")});break;case"InvoiceReportPrinter":t.set({InvoiceReportPrinter:e.get("ReportName")});break;case"InvoiceReportPrinter2":t.set({InvoiceReportPrinter2:e.get("ReportName")});break;case"CreditCardReportPrinter":t.set({CreditCardReportPrinter:e.get("ReportName")});break;case"OrderReportPrinter":t.set({CreditCardReportPrinter:e.get("ReportName")});break;case"PickNoteReportPrinter":t.set({CreditCardReportPrinter:e.get("ReportName")});break;case"QuoteReportPrinter":t.set({CreditCardReportPrinter:e.get("ReportName")});break;case"ReturnReportPrinter":t.set({CreditCardReportPrinter:e.get("ReportName")});break;case"SalePaymentReportPrinter":t.set({CreditCardReportPrinter:e.get("ReportName")})}this.preferenceCollection.reset(t)},GetSelectedReportCode:function(){var e,t=this.preferenceCollection.at(0);switch(this.lookupReportMode){case"InvoiceReportCode":e=t.get("InvoiceReportCode");break;case"ReturnReportCode":e=t.get("ReturnReportCode");break;case"OrderReportCode":e=t.get("OrderReportCode");break;case"QuoteReportCode":e=t.get("QuoteReportCode");break;case"CreditCardReportCode":e=t.get("CreditCardReportCode");break;case"SalePaymentReportCode":e=t.get("SalePaymentReportCode");break;case"PickNoteReportCode":e=t.get("PickNoteReportCode");break;case"XTapeReportCode":e=t.get("XTapeReportCode");break;case"ZTapeReportCode":e=t.get("ZTapeReportCode");break;case"InvoiceReportCode2":e=t.get("InvoiceReportCode2");break;case"ReturnReportCode2":e=t.get("ReturnReportCode2");break;case"OrderReportCode2":e=t.get("OrderReportCode2");break;case"QuoteReportCode2":e=t.get("QuoteReportCode2");break;case"CreditCardReportCode2":e=t.get("CreditCardReportCode2");break;case"SalePaymentReportCode2":e=t.get("SalePaymentReportCode2");break;case"PickNoteReportCode2":e=t.get("PickNoteReportCode2")}return e},SearchReport:function(e){console.log(e),this.FetchReport(50,e)},FetchReport:function(e,t){var r=this,i=new c,a=e;i.set({StringValue:t}),i.url=o.ServiceUrl+n.POS+p.REPORTCODELOOKUP+this.lookupReportMode+"/"+a,i.save(null,{success:function(e,t){o.isBrowserMode||window.plugins.cbNetworkActivity.HideIndicator(),r.receiptCollection.reset(t.ReportViews),r.ValidateCollection(r.receiptCollection)},error:function(e,t,r){o.isBrowserMode||window.plugins.cbNetworkActivity.HideIndicator(),e.RequestError(t,"Error Retrieving Report Code")}})},ValidateData:function(){if(!this.preferenceCollection)return!0;var e=this.preferenceCollection.at(0);return!(!o.isBrowserMode&&e.get("UseCashDrawer")&&e.get("AutoPrintReceipt")&&a.IsNullOrWhiteSpace(o.Printer.PrinterModel)&&a.IsNullOrWhiteSpace(o.Printer.IpAddress))||(navigator.notification.alert("There is no Printer connected as of the moment. Please try again",null,"No Printer Connected","OK"),o.BackToMain=!1,this.IsFocusReceipt=!0,!1)},Save:function(){switch(this.selectedPage){case"DefaultPrinter":case"Receipt":this.UpdateReceiptPreference();break;case"ReceiptTypeListPage":this.UpdateReceiptPreference();break;case"PrintSetting":console.log("UpdatePrintSettings")}this.backToMain&&this.SaveCompleted()},initialize:function(){this.AllowSilentSave=!0,this.on("ReportLookup",this.SearchReport,this),this.render()},GetCheckState:function(t){return!!e(t).hasClass("icon-ok-sign")},ToggleCheckbox:function(t,r){r?(e("#"+t).addClass("icon-ok-sign").css("color",""),e("#"+t).removeClass("icon-circle-blank")):(e("#"+t).addClass("icon-circle-blank").css("color","#DADADA"),e("#"+t).removeClass("icon-ok-sign"))},SetChkState:function(e,t){var r=this;switch(e){case"AutoEmailReceipt":r.autoEmailReceipt=t;break;case"ShowPrintOptions":r.showPrintOptions=t;break;case"AutoPrintReceipt":r.autoPrintReceipt=t,t&&(t=r.autoPrintReceipt_change(t));break;case"IsSinglePageTransactionReceipt":r.singlePageTransaction=t;break;case"InvoiceReceiptAutoPrint":r.invoiceReceiptAutoPrint=t}r.ToggleCheckbox(e,t)},ToggleCheckboxes:function(){var e=this,t=this.preferenceCollection.at(0),i=["AutoEmailReceipt","ShowPrintOptions","AutoPrintReceipt","IsSinglePageTransactionReceipt","InvoiceReceiptAutoPrint"],o=t.get("PromptEmailAddress")||t.get("PromptToPrintReceipt");t.set({ShowPrintOptions:o}),r.each(i,function(r){switch(r){case"IsSinglePageTransactionReceipt":e.singlePageTransaction=t.attributes.IsSinglePageTransactionReceipt;break;case"AutoEmailReceipt":e.autoEmailReceipt=t.attributes.AutoEmailReceipt;break;case"ShowPrintOptions":e.showPrintOptions=t.attributes.ShowPrintOptions;break;case"AutoPrintReceipt":e.autoPrintReceipt=t.attributes.AutoPrintReceipt;break;case"InvoiceReceiptAutoPrint":e.invoiceReceiptAutoPrint=t.attributes.InvoiceReceiptAutoPrint}t.get(r)?e.SetChkState(r,!0):e.SetChkState(r,!1)})},autoPrintReceipt_change:function(e){return!!(""!==o.Printer.IpAddress&&null!==o.Printer.IpAddress||o.isBrowserMode)||(navigator.notification.alert("Please set printer IP address first before enabling AutoPrint.",null,"Required Action","OK"),this.autoPrintReceipt=!1,!1)},UpdatePreference:function(){var t=this,i=t.preferenceCollection.at(0),o=["AutoEmailReceipt","ShowPrintOptions","AutoPrintReceipt","IsSinglePageTransactionReceipt","InvoiceReceiptAutoPrint"];r.each(o,function(e){var r=!1;switch(e){case"IsSinglePageTransactionReceipt":r=t.singlePageTransaction,i.set({IsSinglePageTransactionReceipt:r});break;case"AutoEmailReceipt":r=t.autoEmailReceipt,i.set({AutoEmailReceipt:r});break;case"ShowPrintOptions":r=t.showPrintOptions,i.set({PromptEmailAddress:r,PromptToPrintReceipt:r});break;case"AutoPrintReceipt":r=t.autoPrintReceipt,i.set({AutoPrintReceipt:r});break;case"InvoiceReceiptAutoPrint":r=t.invoiceReceiptAutoPrint,i.set({InvoiceReceiptAutoPrint:r})}}),i.set({InvoiceReceiptCopies:e("#InvoiceReceiptCopies").val(),OrderReceiptCopies:e("#OrderReceiptCopies").val(),QuoteReceiptCopies:e("#QuoteReceiptCopies").val(),ReturnReceiptCopies:e("#ReturnReceiptCopies").val(),CreditCardReceiptCopies:e("#CreditCardReceiptCopies").val(),SalePaymentReceiptCopies:e("#SalePaymentReceiptCopies").val(),PickNoteReceiptCopies:e("#PickNoteReceiptCopies").val(),InvoiceReceiptCopies2:e("#InvoiceReceiptCopies2").val(),OrderReceiptCopies2:e("#OrderReceiptCopies2").val(),QuoteReceiptCopies2:e("#QuoteReceiptCopies2").val(),ReturnReceiptCopies2:e("#ReturnReceiptCopies2").val(),CreditCardReceiptCopies2:e("#CreditCardReceiptCopies2").val(),SalePaymentReceiptCopies2:e("#SalePaymentReceiptCopies2").val(),PickNoteReceiptCopies2:e("#PickNoteReceiptCopies2").val()}),this.preferenceCollection.reset(i)},InitializeDisplay:function(){this.SetSelectedPage("Receipt");var t=this.preferenceCollection.at(0);this.AssignAirprint(t),e("#settings-report-search").remove(),e("#right-pane-content").html(""),e("#right-pane-content").css("padding",""),this.$el.html(this._template(t.toJSON())),o.isBrowserMode&&e(".printerSettings").remove(),this.ToggleCheckboxes(),this.ConfigureListItems(t),o.isBrowserMode?a.UseBrowserScroll(".settings-left-pane #receipt-left-pane-content"):this.myScroll=new iScroll("scroll-wrapper")},AssignAirprint:function(e){e.get("IsAirprint")?e.set({IsAirprintDisplay:"AirPrint-enabled Printer"}):e.set({IsAirprintDisplay:"Receipt Printer"})},ConfigureListItems:function(t){var r=t.get("IsAirprint");r&&!o.isBrowserMode?e("#auto-print-receipt").addClass("ui-disabled"):e("#auto-print-receipt").removeClass("ui-disabled")},ToggleAskToPrint:function(){this.allowAskToPrintReceipt===!1?(e("#li-ask-to-print-receipt").addClass("ui-disabled"),e("#div-ask-to-print-receipt > h1 > span").removeClass("ui_check_switch_on").addClass("ui_check_switch_off"),e("#div-ask-to-print-receipt > h1 > div > span .ui_check_switch_slider").css("margin-left","-50px")):e("#li-ask-to-print-receipt").removeClass("ui-disabled")},AutoPrintReceipt_toggled:function(e){_isChecked?this.allowAskToPrintReceipt=!1:this.allowAskToPrintReceipt=!0},showPrintSettings:function(){this.UpdatePreference(),this.InitializePrintSettings()},render:function(){this.AllowSilentSave=!0,this.FetchPreference()},InitializePrintSettings:function(){this.SetSelectedPage("PrintSetting");var t=this.preferenceCollection.at(0);this.settingsModal=new C({el:e("#settings-modal-container"),model:t,preferencetype:"Printer"}),this.settingsModal.on("ModalClose",this.OnModalClose,this),this.settingsModal.printSettings.on("SaveCompleted",this.SaveCompleted,this),this.settingsModal.printSettings.SetPreferences(this.preferences)},OnModalClose:function(){e("#settings-modal-container").removeClass("settings-modal-receipt-printer"),this.UpdatePrintSettings()},InitializePreferences:function(){this.preferences||(this.preferences=new l)},InitializePreferenceCollection:function(){this.preferenceCollection||(this.preferenceCollection=new l)},FetchPreference:function(){var e=this;this.InitializePreferenceCollection(),this.InitializePreferences(),this.preferences.url=o.ServiceUrl+n.POS+p.GETPREFERENCEBYWORKSTATION+o.POSWorkstationID,this.preferences.fetch({success:function(t,r){e.ResetPreferenceCollection(r.Preference)},error:function(e,t,r){o.isBrowserMode||window.plugins.cbNetworkActivity.HideIndicator(),e.RequestError(t,"Error Retrieving Workstation Preference")}})},UpdateReceiptPreference:function(){if(this.preferenceCollection&&0!==this.preferenceCollection.length&&this.preferences&&0!==this.preferences.length){this.UpdatePreference();var e=this,t=this.preferences.at(0);t.set({Preference:this.preferenceCollection.at(0)}),t.url=o.ServiceUrl+n.POS+p.UPDATEPREFERENCE,t.save(null,{success:function(t,r){e.IsSilentSave()?e.SilentSaveCompleted():e.SaveCompleted()},error:function(e,t,r){o.isBrowserMode||window.plugins.cbNetworkActivity.HideIndicator(),e.RequestError(t,"Error Saving Workstation Preference")}})}},UpdatePrintSettings:function(){this.settingsModal.printSettings.Save()},SetSelectedPage:function(e){this.selectedPage=e},SaveCompleted:function(){o.isBrowserMode||window.plugins.cbNetworkActivity.HideIndicator(),e("#settings-report-search").remove(),console.log("SaveReceipt"),this.trigger("SaveCompleted",this)},ResetPreferenceCollection:function(e){o.isBrowserMode||window.plugins.cbNetworkActivity.HideIndicator();var t=this;printerTool.getDefaultPrinter().then(function(r){e.DefaultPrinter=e.DefaultPrinter||r,e.InvoiceReportPrinter=e.InvoiceReportPrinter||r,e.InvoiceReportPrinter2=e.InvoiceReportPrinter2||r,e.CreditCardReportPrinter=e.CreditCardReportPrinter||r,e.OrderReportPrinter=e.OrderReportPrinter||r,e.PickNoteReportPrinter=e.PickNoteReportPrinter||r,e.QuoteReportPrinter=e.QuoteReportPrinter||r,e.ReturnReportPrinter=e.ReturnReportPrinter||r,e.SalePaymentReportPrinter=e.SalePaymentReportPrinter||r,t.preferenceCollection.reset(e),t.InitializeDisplay()})},SilentSaveCompleted:function(){this.render(),this.RemoveSearchTemplate()},IsSilentSave:function(){return"ReceiptTypeListPage"==this.selectedPage&&!a.IsNullOrWhiteSpace(this.AllowSilentSave)},RemoveSearchTemplate:function(){e("#settings-report-search").remove(),e("#back-general").hide()},CreditCardReceiptCopies_Change:function(t){this.preferenceCollection.at(0)&&this.preferenceCollection.at(0).set({CreditCardReceiptCopies:parseInt(e("#CreditCardReceiptCopies").val())})},TextNumber_Changed:function(e){var t=e.srcElement;t&&t.value.length>t.maxLength&&(t.value=t.value.slice(0,t.maxLength))}});return h});