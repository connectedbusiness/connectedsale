define(["jquery","mobile","underscore","backbone","shared/global","shared/method","shared/service","model/reason","view/20.0.0/pos/reason/reasons","text!template/20.0.0/pos/reason/itemreason.tpl.html"],function(e,t,o,n,i,s,a,r,l,c){var h=n.View.extend({_template:o.template(c),events:{"tap #item-select-reason-btn":"loadReason_touchstart","tap #item-cancel-reason":"cancel_touchstart","tap #item-save-reason":"save_touchstart","keypress #item-reason-textarea":"CheckReasonInput"},initialize:function(){e("input").blur(),e("#itemDetailContainer").is(":visible")&&e("#itemDetailContainer").hide(),this.collection.on("selected",this.LoadSelectedReason,this),this.type=this.options.type,console.log("type-handled : "+this.type),this.render()},InitializeReasonModel:function(){this.reasonModel?this.reasonModel.clear({silent:!0}):(this.reasonModel=new r,this.reasonModel.on("sync",this.SuccessComplete,this),this.reasonModel.on("error",this.ErrorSaving,this),this.reasonModel.url=i.ServiceUrl+a.POS+s.SAVEREASON)},render:function(){this.$el.html(this._template),this.CheckCollection(),this.CheckReasonInput(),e("#reasonPage-inner").trigger("create"),e("#main-transaction-blockoverlay").show(),e("#item-reason-textarea").focus()},CheckCollection:function(){0===this.collection.length&&e("#item-select-reason-btn").addClass("ui-disabled")},CheckReasonInput:function(){var t=e("#item-reason-textarea").val();""===t?e("#item-save-reason").addClass("ui-disabled"):e("#item-save-reason").removeClass("ui-disabled")},CheckType:function(e){return"DiscountAll"===e&&(e="Discount"),e},Close:function(){e("#main-transaction-blockoverlay").hide(),this.remove(),this.unbind()},Show:function(e,t){this.$el=t,this.type=e,console.log("type-handled : "+this.type),this.render()},cancel_touchstart:function(e){e.preventDefault(),this.Close()},save_touchstart:function(e){e.preventDefault(),this.LogReasonWithValidation()},loadReason_touchstart:function(t){t.preventDefault(),this.ShowReasonView(this.collection),e("#item-reason-textarea").blur()},LoadSelectedReason:function(t){this.model=t,this.render(),e("#item-save-reason").removeClass("ui-disabled"),e("#item-reason-textarea").val(t.get("Description")),this.reason=t.get("Description")},SetReasonCode:function(e){var t="";return e&&(t=e.get("ReasonCode")),t},ShowReasonView:function(t){var o=new l({el:e("#reasonPage-inner")});o.render(t)},RemoveDummyModel:function(){var e=this;this.collection.each(function(t){"removeThis"===t.get("ToRemove")&&e.collection.remove(t)})},SaveReason:function(t){this.RemoveDummyModel(),this.reasonModel||this.InitializeReasonModel(),console.log(this.type);var o=this.SetReasonCode(this.model);t=e("#item-reason-textarea").val(),this.reasonModel.set({WorkstationID:i.POSWorkstationID,Reason:t,ReasonCode:o,TransactionCode:i.TransactionCode,TransactionType:i.TransactionType,Action:this.type}),this.reasonModel.save()},SuccessComplete:function(e,t){i.isBrowserMode||window.plugins.cbNetworkActivity.HideIndicator(),i.LoggedReasons.add(e.attributes),this.triggerSaveReason(e),this.Close()},ErrorSaving:function(e,t,o){i.isBrowserMode||window.plugins.cbNetworkActivity.HideIndicator(),e.RequestError(t,"Error Saving Reason Code")},triggerSaveReason:function(e){0===this.collection.length?this.collection.add({Action:this.type},{silent:!0}):this.collection.at(0).set({Action:this.type},{silent:!0}),this.collection.at(0).saveItemReason()},AcceptReason:function(){this.collection.at(0).acceptReason()},ValidateReason:function(){var t=e("#item-reason-textarea").val();""!==t&&t?this.SaveReason(t):(console.log("Please enter a reason to proceed.."),navigator.notification.alert("Please enter a reason to proceed.",null,"Reason is Required","OK"))},LogReasonWithValidation:function(){var t=e("#item-reason-textarea").val();return""===t?(console.log("Please enter a reason to proceed.."),void navigator.notification.alert("Please enter a reason to proceed.",null,"Reason is Required","OK")):void("Item"===this.type?this.SaveReason(t):(0===this.collection.length&&this.collection.push({ToRemove:"removeThis"},{silent:!0}),this.AcceptReason()))}});return h});