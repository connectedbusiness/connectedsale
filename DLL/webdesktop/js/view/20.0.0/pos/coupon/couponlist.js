define(["jquery","mobile","underscore","backbone","shared/global","shared/service","shared/method","model/lookupcriteria","view/20.0.0/pos/coupon/couponitem","view/spinner","text!template/20.0.0/pos/coupon/couponlist.tpl.html","js/libs/iscroll.js"],function(t,e,o,n,i,s,r,c,l,p,h){var a=n.View.extend({_template:o.template(h),events:{"keypress #coupon-search":"inputCouponSearch_KeyPress","blur #coupon-search":"HideClearBtn"," #coupon-searchClearBtn":"ClearText"},initialize:function(){this.collection.on("reset",this.AddAllCoupon,this),this.render()},render:function(){this.$el.html(this._template),this.$("#coupon-content").trigger("create"),this.FetchCoupons()},FetchCoupons:function(){var t=this,e=this.$("#coupon-search").val(),o=new c,n=100;e||(e=""),o.set({CustomerCode:i.CustomerCode,CriteriaString:e}),this.ShowActivityIndicator(),o.url=i.ServiceUrl+s.SOP+r.COUPONLOOKUP+n,o.save(null,{success:function(e,o){i.isBrowserMode||window.plugins.cbNetworkActivity.HideIndicator(),t.ResetCouponCollection(o.Coupons)},error:function(e,o,n){i.isBrowserMode||window.plugins.cbNetworkActivity.HideIndicator(),t.HideActivityIndicator(),e.RequestError(o,"Error Retrieving Coupons")}})},ResetCouponCollection:function(t){this.collection.reset(t)},AddOneCoupon:function(e){var o=new l({model:e});this.$("#couponListContainer").append(o.render().el),t("#couponListContainer").listview("refresh"),this.RefreshScroll()},RefreshScroll:function(){return i.isBrowserMode?void t("#coupon-content").css("overflow-y","auto"):void(this.myScroll?this.myScroll.refresh():this.myScroll=new iScroll("coupon-content"))},ShowNoData:function(){this.$(".no-data").show()},AddAllCoupon:function(){!this.collection.length>0&&this.ShowNoData(),this.$("#couponListContainer").empty(),this.collection.each(this.AddOneCoupon,this),this.HideActivityIndicator()},Show:function(){this.render()},inputCouponSearch_KeyPress:function(t){13===t.keyCode?this.FetchCoupons():this.ShowClearBtn(t)},ShowActivityIndicator:function(){t("#spin").remove(),t("<div id='spin'></div>").appendTo(this.$("#coupon-content"));var e=document.getElementById("spin");this._spinner=p,this._spinner.opts.color="#fff",this._spinner.opts.lines=13,this._spinner.opts.length=7,this._spinner.opts.width=4,this._spinner.opts.radius=10,this._spinner.opts.top="auto",this._spinner.opts.left="auto",this._spinner.spin(e),t("<h5>Loading...</h5>").appendTo(t("#spin"))},HideActivityIndicator:function(){t("#spin").remove(),this._spinner.stop()},ShowClearBtn:function(e){e.stopPropagation();var o=e.target.id,n=t("#"+o).val(),i=n.length,s=t("#"+o).position(),r=t("#"+o).width();i<=0?this.HideClearBtn():(console.log(o),null===s&&""===s||(t("#"+o+"ClearBtn").css({top:s.top+7,left:s.left+(r-18)}),t("#"+o+"ClearBtn").show()))},HideClearBtn:function(){t(".clearTextBtn").fadeOut()},ClearText:function(e){var o=e.target.id,n=o.substring(0,o.indexOf("ClearBtn"));t("#"+n).val(""),this.HideClearBtn()}});return a});