define(["jquery","mobile","underscore","backbone","model/base","shared/enum","shared/global","shared/method","shared/shared","shared/service","text!template/20.0.0/pos/cart/summary.tpl.html"],function(e,t,a,n,i,r,s,o,l,c,p){var y=n.View.extend({_template:a.template(p),events:{"tap #view-payment":"payment_tap","tap #view-notes":"ordernotes_tap","tap #view-signature":"signature_tap","tap #view-tax":"taxList_tap","tap .taxqs":"showTaxName"},attributes:{id:"summary"},initialize:function(){this.type=this.options.type,this.model.bind("change",this.render,this),e("#totalsummary").attr("style","display: none")},render:function(){return this.RecomputeBalance(),this.model.set({CurrencySymbol:s.CurrencySymbol}),this.LoadCompanyImg(),this.$el.html(this._template(this.model.attributes)),this.ToggleFields(),s.Preference.AllowChangeTaxCode||e("#view-tax").attr("style","color: #666; cursor: default"),s.TransactionType==r.TransactionType.SalesRefund?(e("#paymentsummary").attr("style","display: none"),e("#balancesummary").attr("style","display: none"),e("#totalsummary").attr("style","display: inline")):(e("#paymentsummary").attr("style","display: inline"),e("#balancesummary").attr("style","display: inline"),e("#totalsummary").attr("style","display: none")),this},RecomputeBalance:function(){if(!this.model)return 0;var e=parseFloat(this.model.Balance()),t=e;s.TransactionType==r.TransactionType.ConvertOrder&&e<0&&(t=0),this.model.set({Balance:t},{silent:!0})},LoadCompanyImg:function(){var e=s.ServiceUrl+o.COMPANYIMAGE+s.CompanyName+".png";this.model.set({ImageLocation:e},{silent:!0})},payment_tap:function(e){e.preventDefault(),this.ViewPayments()},signature_tap:function(e){e.preventDefault(),this.ViewSignature()},ordernotes_tap:function(e){e.preventDefault(),this.LoadOrderNotes()},taxList_tap:function(e){s.Preference.AllowChangeTaxCode&&s.TransactionType!=r.TransactionType.SalesRefund&&s.TransactionType!=r.TransactionType.SalesPayment&&(e.preventDefault(),this.ViewTaxOverrideList())},ViewPayments:function(){this.trigger("viewPayments",this)},ViewTaxOverrideList:function(){this.trigger("viewTaxOverrideList",this)},ToggleFields:function(){var e=s.TransactionType!=r.TransactionType.Order&&s.TransactionType!=r.TransactionType.ConvertInvoice&&s.TransactionType!=r.TransactionType.UpdateOrder&&s.TransactionType!=r.TransactionType.ConvertQuote&&s.TransactionType!=r.TransactionType.Sale&&s.TransactionType!=r.TransactionType.UpdateInvoice&&s.TransactionType!=r.TransactionType.ResumeSale&&s.TransactionType!=r.TransactionType.Quote&&s.TransactionType!=r.TransactionType.UpdateQuote;this.ToggleOrderNotes(e),s.TransactionType===r.TransactionType.SalesRefund&&(this.$(".summary-right").children("div:last-child").hide(),this.$(".summary-right").find("#view-tax").attr("style","color: #666; cursor: default;")),s.TransactionType===r.TransactionType.SalesPayment&&this.$(".summary-right").find("#view-tax").attr("style","color: #666; cursor: default;")},ViewSignature:function(){this.trigger("viewSignature",this)},ToggleOrderNotes:function(e){},LoadOrderNotes:function(){this.trigger("loadOrderNotes","OrderNotes")},showTaxName:function(e){e.preventDefault();var t=window.sessionStorage.getItem("selected_taxcode");t=t?t:s.ShipTo.TaxCode,this.$(e.currentTarget).find(".taxpopover").html(t).show().delay(2e3).fadeOut()},LoadWarehouseTaxCode:function(){var e=new i;e.url=s.ServiceUrl+c.SOP+o.GETLOCATIONTAXCODE+s.DefaultLocation+"/"+s.CustomerCode,e.fetch({success:function(e,t,a){console.log(t)}.bind(this),error:function(e,t,a){console.log(t)}.bind(this)})}});return y});