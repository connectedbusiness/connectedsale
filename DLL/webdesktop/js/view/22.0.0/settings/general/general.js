define(["jquery","mobile","underscore","backbone","base64","shared/global","shared/service","shared/method","shared/shared","model/base","model/lookupcriteria","model/preference","model/website","collection/base","collection/websites","collection/customers","collection/categories","collection/locations","collection/shippingMethods","collection/merchant","collection/paymenttype","collection/preferences","collection/workstations","collection/userroles","collection/localpreferences","view/22.0.0/settings/modal/modal","view/22.0.0/settings/general/imagesize/imagesize","view/22.0.0/settings/general/website/websitelist","view/22.0.0/settings/general/customer/customers","view/22.0.0/settings/general/taxscheme/taxschemes","view/22.0.0/settings/general/location/locations","view/22.0.0/settings/general/gateway/gateways","view/22.0.0/settings/general/paymenttype/paymenttypes","view/22.0.0/settings/general/workstation/workstations","view/22.0.0/settings/general/kiosk/kiosk","view/22.0.0/settings/general/pos/pos","view/22.0.0/settings/general/email/email","text!template/22.0.0/settings/general/generalpage.tpl.html","text!template/22.0.0/settings/general/email/defaultmessage.tpl.html","js/libs/ui.checkswitch.min.js","js/libs/iscroll.js"],function(e,t,i,o,s,a,n,r,l,c,h,p,u,d,g,C,f,m,k,w,S,b,P,T,I,y,A,v,D,O,M,W,U,x,F,R,E,B,L){var _,N,V,z,H,X,Z="",G=o.View.extend({_template:i.template(B),_defaultMessageTemplate:i.template(L),isValid:!0,isReceiptInvalid:!1,events:{"tap #customer-preference-btn":"buttonCustomerPreference_tap","tap #location-preference-btn":"buttonLocationPreference_tap","tap #shippingmethod-preference-btn":"buttonShippingMethodPreference_tap","tap #gateway-preference-btn":"buttonGatewayPreference_tap","tap #paymenttype-preference-btn":"buttonPaymentTypePreference_tap","tap #workstation-preference-btn":"buttonWorkstationPreference_tap","tap #kiosk-preference-btn":"buttonKioskPreference_tap","tap #pos-preference-btn":"buttonPOSPreference_tap","tap #website-preference-btn":"buttonWebsitePreference_tap","tap #image-size-preference-btn":"buttonImageSizePreference_tap","tap #salestaxexempt-preference-btn":"buttonSalesTaxPreference_tap","tap #email-preference-btn":"buttonEmailPreference_tap","change #OrderExpiration":"OrderExpiration_Change","blur #OrderExpiration":"RevertPreviousValue","focus #OrderExpiration":"SaveAndClearValue","change #NotificationInterval":"NotificationInterval_Change","blur #NotificationInterval":"RevertPreviousValue","focus #NotificationInterval":"SaveAndClearValue","tap #AllowSales, #AllowQuotes, #AllowOrders, #AllowReturns, #AllowChangePrice, #AllowAddCustomer, #AllowChangeClassTemplate, #AllowChangePaymentTerm, #AllowChangeTaxCode, #AllowTaxOnLineItems, #IsUseCustomerShipToPaymentType,#IsUsePOSShippingMethod, #UseForcePayment, #IsDepositPayment, #AutoSignOutUser, #IsOverrideSalesRep, #TaxByLocation, #ShowCouponList, #ShowWholesalePrice, #UseCashDrawer, #IsUseItemDescription, #TrackDrawerBalance, #BlindClose, #IsAllowViewZXTape, #IsUseISEImage, #AskForPaymentTerm, #AskForShippingMethod, #AskForContact, #AskForCustomerPO, #AskForShipDate, #AskForSource, #IsAutoAdjustmentStock, #IsTrackStorePickUp":"Chkbox_click"},buttonPOSPreference_tap:function(e){e.preventDefault(),this.UpdateCollection(),this.InitializePOSDisplay(this.preferenceCollection.at(0))},buttonKioskPreference_tap:function(e){e.preventDefault(),this.UpdateCollection(),this.InitializeKioskDisplay(this.preferenceCollection.at(0))},buttonCustomerPreference_tap:function(e){e.preventDefault(),this.UpdateCollection(),this.FetchCustomer(100,"")},buttonLocationPreference_tap:function(e){e.preventDefault(),this.UpdateCollection(),this.InitializeLocationDisplay(this.locationCollection)},buttonShippingMethodPreference_tap:function(e){e.preventDefault(),this.UpdateCollection(),this.InitializeShippingMethodDisplay(this.shippingMethodCollection)},buttonGatewayPreference_tap:function(e){e.preventDefault(),this.UpdateCollection(),this.InitializeGatewayDisplay(this.gatewayCollection)},buttonPaymentTypePreference_tap:function(e){e.preventDefault(),this.UpdateCollection(),this.InitializePaymentTypeDisplay(this.paymentTypeCollection)},buttonWebsitePreference_tap:function(e){e.preventDefault(),this.UpdateCollection(),this.FetchWebsite(100," ")},buttonImageSizePreference_tap:function(e){e.preventDefault(),this.UpdateCollection(),this.InitializeImageSizeDisplay(this.preferenceCollection.at(0))},buttonSalesTaxPreference_tap:function(e){e.preventDefault(),this.UpdateCollection(),this.FetchTaxSchemes("")},buttonWorkstationPreference_tap:function(e){e.preventDefault(),this.IsWebSiteURLSpecified()&&(a.PreviousWorkstationID=this.preferenceCollection.at(0).get("WorkstationID"),this.isWorkstationPage=!0,null!==a.PreviousWorkstationID&&(this.preventSaveCompleted=!0,this.Save()),a.BackToGeneralTriggered=!1,this.FetchWorkstation(100,""))},buttonEmailPreference_tap:function(t){t.preventDefault();var i=this.preferenceCollection.at(0);return i.get("WorkstationID")?(this.pickupEmailPreference.set({WorkstationID:i.get("WorkstationID")}),this.settingsModal=new y({el:e("#settings-modal-container"),model:this.pickupEmailPreference,preferencetype:"Email"}),void this.settingsModal.on("ModalClose",this.RemoveClassOnEmail,this)):(console.log("WorkstationID must not be null"),void navigator.notification.alert("Please select a Workstation first.",null,"Workstation ID is Required","OK"))},RemoveClassOnEmail:function(){e("#settings-modal-container").removeClass("settings-modal-email-template")},Chkbox_click:function(e){e.preventDefault();var t="#"+e.currentTarget.id,i=this.GetCheckState(t);this.SetChkState(e.currentTarget.id,!i)},GetCheckState:function(t){return!!e(t).hasClass("icon-ok-sign")},SetChkState:function(e,t){var i=this;switch(e){case"AllowSales":_=t,i.CheckTransactionState(t,e);break;case"AllowQuotes":N=t,i.CheckTransactionState(t,e);break;case"AllowOrders":V=t,i.CheckTransactionState(t,e);break;case"AllowReturns":z=t,i.CheckTransactionState(t,e);break;case"AllowChangePrice":allowChangePrice=t,i.ToggleCheckbox(e,t);break;case"AllowAddCustomer":allowAddCustomer=t,i.ToggleCheckbox(e,t);break;case"AllowChangeClassTemplate":allowChangeClassTemplate=t,i.ToggleCheckbox(e,t);break;case"AllowChangePaymentTerm":allowChangePaymentTerm=t,i.ToggleCheckbox(e,t);break;case"AllowChangeTaxCode":allowChangeTaxCode=t,i.ToggleCheckbox(e,t);break;case"AllowTaxOnLineItems":allowTaxOnLineItems=t,i.ToggleCheckbox(e,t);break;case"IsDepositPayment":isDepositPayment=t,i.ToggleCheckbox(e,t);break;case"AutoSignOutUser":autoSignOutUser=t,i.ToggleCheckbox(e,t);break;case"IsOverrideSalesRep":isOverrideSalesRep=t,i.ToggleCheckbox(e,t);break;case"TaxByLocation":taxByLocation=t,i.ToggleCheckbox(e,t);break;case"ShowCouponList":showCouponList=t,i.ToggleCheckbox(e,t);break;case"ShowWholesalePrice":showWholesalePrice=t,i.ToggleCheckbox(e,t);break;case"IsUseItemDescription":isUseItemDescription=t,i.ToggleCheckbox(e,t);break;case"AskForPaymentTerm":askForPaymentTerm=t,i.ToggleCheckbox(e,t);break;case"AskForShippingMethod":askForShippingMethod=t,i.ToggleCheckbox(e,t);break;case"AskForContact":askForContact=t,i.ToggleCheckbox(e,t);break;case"AskForCustomerPO":askForCustomerPO=t,i.ToggleCheckbox(e,t);break;case"AskForShipDate":askForShipDate=t,i.ToggleCheckbox(e,t);break;case"AskForSource":askForSource=t,i.ToggleCheckbox(e,t);break;case"IsAutoAdjustmentStock":isAutoAdjustmentStock=t,i.ToggleCheckbox(e,t);break;case"IsTrackStorePickUp":trackStorePickUp=t,i.ToggleCheckbox(e,t);break;case"TrackDrawerBalance":trackDrawerBalance=t,i.ToggleCheckbox(e,t),a.trackDrawerBalanceState=t,i.DisableBlindClose(),i.trackDrawerBalance_change(t);break;case"BlindClose":trackDrawerBalance||(t=!1),blindClose=t,i.ToggleCheckbox(e,t),t?i.BlindCloseOn():i.AllowBlindClose();break;case"IsUseISEImage":IsUseISEImage=t,a.IsUseImage=t,i.EnableISEImageSettings(t),i.ToggleCheckbox(e,t);break;case"IsUseCustomerShipToPaymentType":isUseCustomerShipToPaymentType=t,i.isUseCustomerShipToPaymentType_change(t),i.ToggleCheckbox(e,t);break;case"IsUsePOSShippingMethod":isUsePOSShippingMethod=t,i.isUsePOSShippingMethod_change(t),i.ToggleCheckbox(e,t);break;case"UseForcePayment":useForcePayment=t,i.CheckTransactionState(t,e),i.ToggleCheckbox(e,t);break;case"IsAllowViewZXTape":blindClose||(t=!1),isAllowViewZXTape=t,i.ToggleCheckbox(e,t),i.isAllowViewZXTape_change(t);break;case"UseCashDrawer":useCashDrawer=t,i.useCashDrawer_change(t),i.ToggleCheckbox(e,t)}},ToggleCheckbox:function(t,i){i?(e("#"+t).addClass("icon-ok-sign").css("color",""),e("#"+t).removeClass("icon-circle-blank")):(e("#"+t).addClass("icon-circle-blank").css("color","#DADADA"),e("#"+t).removeClass("icon-ok-sign"))},AssignNumericValidation:function(e){a.InventoryPreference.IsAllowFractional?l.Input.NonNegative("#"+e.target.id):l.Input.NonNegativeInteger("#"+e.target.id)},SaveAndClearValue:function(t){var i="#"+t.target.id,o=e(i).val();this.lastQty=o,e(i).val(""),this.AssignNumericValidation(t)},RevertPreviousValue:function(t){var i="#"+t.target.id,o=e(i).val(),s="";s=""!==o?parseFloat(o):this.lastQty,e(i).val(s)},OrderExpiration_Change:function(t){this.preferenceCollection.at(0)&&this.preferenceCollection.at(0).set({OrderExpiration:parseInt(e("#OrderExpiration").val())})},NotificationInterval_Change:function(t){if(this.preferenceCollection.at(0)){var i=parseInt(e("#NotificationInterval").val());i<a.MinimumNotificationInterval&&(i=a.MinimumNotificationInterval,e("#NotificationInterval").val(i),l.ShowNotification("Minimum Notification Interval is "+a.MinimumNotificationInterval+" Minutes",!0)),this.preferenceCollection.at(0).set({NotificationInterval:i})}},trackDrawerBalance_change:function(e){if(a.Preference.TrackDrawerBalance=e,a.Preference.TrackDrawerBalance||!a.Status.IsOpen||e)a.PromptCloseWorkstation=!1;else{a.PromptCloseWorkstation=!0;var t="Warning! This workstation is still open, you'll be asked to close this workstation after you save your changes.";console.log(t),this.trackDrawerSwitch=e,navigator.notification.confirm(t,X.ForceCloseWorkstationConfirmation,"Workstation Still Open.","Yes,No")}},isAllowViewZXTape_change:function(e){a.Preference.AllowViewPrintZXTape=e,this.preferenceCollection.at(0).set({IsAllowViewZXTape:e})},isUseCustomerShipToPaymentType_change:function(t){t?(e("#paymenttype-preference-btn").addClass("ui-disabled"),e("#gateway-preference-btn").addClass("ui-disabled"),e("#paymenttype-preference-btn").css("opacity","1"),e("#gateway-preference-btn").css("opacity","1"),e("#IsUseCustomerShipToPaymentTypeLabel").css("background-color","#E2E2E2")):(e("#paymenttype-preference-btn").removeClass("ui-disabled"),e("#gateway-preference-btn").removeClass("ui-disabled"),e("#IsUseCustomerShipToPaymentTypeLabel").css("background-color","#FFF"),e("#IsUseCustomerShipToPaymentTypeLabel").css("margin-bottom","12px"))},isUsePOSShippingMethod_change:function(t){t?(e("#shippingmethod-preference-btn").removeClass("ui-disabled"),e("#IsUsePOSShippingMethodLabel").css("margin-bottom","12px"),e("#IsUsePOSShippingMethodLabel").css("background-color","#E2E2E2")):(e("#shippingmethod-preference-btn").addClass("ui-disabled"),e("#shippingmethod-preference-btn").css("opacity","1"),e("#IsUsePOSShippingMethodLabel").css("background-color","#FFF"))},useCashDrawer_change:function(e){this.useCashDrawer=e},goToReceipts:function(e){return 1!==e?void X.useCashDrawer.off():(X.isRedirectToReceipts=!0,console.log("UseCashDrawer: "+X.preferenceCollection.at(0).get("UseCashDrawer")),X.UpdateCollection(),X.Save(),X.trigger("forceUserToSetPrinter",this),void 0)},initialize:function(){X=this,this.preventSaveCompleted=!1,this.on("CustomerLookup",this.SearchCustomer,this),this.on("SearchWorkstation",this.CheckIfWorkstationExist,this),this.on("iSaveWorkStationID",this.SaveWorkStationID,this),this.on("LocationLookup",this.SearchLocation,this),console.log("IP - "+a.Printer.IpAddress+" MODEL - "+a.Printer.PrinterModel)},render:function(){X=this,this.removeAndHide(),this.isValid=!0,this.InitializeLocalPreference(),this.InitializeAllowBlindClose(),0===this.localpreference.length?(a.POSWorkstationID="NoWorkstationId"+Math.random(),this.ShowView()):this.FetchWorkstation(100,this.localpreference.at(0).get("WorkstationID"),"Check")},AllowBlindClose:function(){this.userRoleCollection&&this.userRoleCollection.length>0&&(1==a.trackDrawerBalanceState&&0==a.AdministratorRole&&0==a.IsOnLoad&&1==a.Preference.BlindClose?(e("#BlindClose-container > h1 > span").removeClass("ui_check_switch_off").addClass("ui_check_switch_on"),e("#BlindClose-container > h1 > span .ui_check_switch_slider").css("margin-left","0px"),e("#BlindClose").attr("checked",!0),navigator.notification.alert("You are not authorized to change this setting.",null,"Action Not Allowed","OK")):(e("#AllowViewZXTape-li").addClass("ui-disabled"),e("#IsAllowViewZXTape").attr("checked",!1),e("#AllowViewZXTape-container > h1 > span").removeClass("ui_check_switch_on").addClass("ui_check_switch_off"),e("#AllowViewZXTape-container > h1 > span .ui_check_switch_slider").css("margin-left","-50px"),this.ToggleCheckbox("IsAllowViewZXTape",!1))),e("#AllowViewZXTape-li").addClass("ui-disabled"),a.IsOnLoad=!1},BlindCloseOn:function(t){t?(e("#AllowViewZXTape-li").addClass("ui-disabled"),e("#IsAllowViewZXTape").attr("checked",!1),e("#AllowViewZXTape-container > h1 > span").removeClass("ui_check_switch_on").addClass("ui_check_switch_off"),e("#AllowViewZXTape-container > h1 > span .ui_check_switch_slider").css("margin-left","-50px")):e("#AllowViewZXTape-li").removeClass("ui-disabled")},DisableBlindClose:function(t){if(trackDrawerBalance){if(e("#BlindClose-li").removeClass("ui-disabled"),!this.userRoleCollection)return;if(this.userRoleCollection.length<=0)return;0==a.AdministratorRole&&(e("#BlindClose-container > h1 > span").removeClass("ui_check_switch_off").addClass("ui_check_switch_on"),e("#BlindClose-container > h1 > span .ui_check_switch_slider").css("margin-left","0px"),e("#BlindClose").attr("checked",!0),a.Preference.BlindClose=!0,a.Preference.AllowViewPrintZXTape=!0)}else e("#BlindClose-li").addClass("ui-disabled"),e("#BlindClose").attr("checked",!1),e("#BlindClose-container > h1 > span").removeClass("ui_check_switch_on").addClass("ui_check_switch_off"),e("#BlindClose-container > h1 > span .ui_check_switch_slider").css("margin-left","-50px"),e("#AllowViewZXTape-li").addClass("ui-disabled"),e("#IsAllowViewZXTape").attr("checked",!1),e("#AllowViewZXTape-container > h1 > span").removeClass("ui_check_switch_on").addClass("ui_check_switch_off"),e("#AllowViewZXTape-container > h1 > span .ui_check_switch_slider").css("margin-left","-50px"),this.ToggleCheckbox("BlindClose",!1),this.ToggleCheckbox("IsAllowViewZXTape",!1)},InitializeAllowBlindClose:function(){a.trackDrawerBalanceState=a.TrackDrawerBalance,1==a.Preference.BlindClose&&1==a.TrackDrawerBalance?a.IsOnLoad=!1:a.IsOnLoad=!0},SearchCustomer:function(e){console.log(e),this.FetchCustomer(100,e)},SearchLocation:function(e){console.log(e),this.FetchLocation(100,e)},SearchMerchant:function(e){console.log(e),this.FetchMerchant(100,e)},SearchPaymentType:function(e){this.FetchPaymentType(100,e)},InitializeImageSizeDisplay:function(t){this.settingsModal=new y({el:e("#settings-modal-container"),model:t,preferencetype:"ImageSize",general:this}),this.settingsModal.imageSizePreference.on("selected",this.imageSizeSelected_changed,this)},imageSizeSelected_changed:function(e){var t=e.selectedImagesize;this.preferenceCollection.at(0).set({ISEImageSize:t}),this.FetchImageSizeEquivalent()},FetchImageSizeEquivalent:function(){var e;switch(this.preferenceCollection.at(0).get("ISEImageSize")){case 0:e="Medium";break;case 1:e="Large";break;case 2:e="Icon";break;case 3:e="Minicart";break;case 4:e="Mobile"}this.$("#ISEImageSizeContent").text(e)},removeAndHide:function(){e("#settings-customer-search").remove(),e("#settings-workstation-container").remove(),e("#settings-location-search").remove(),e("#settings-website-search").remove(),e("#settings-salesexempttaxcode-search").remove(),e("#back-general").hide()},ShowView:function(){this.ValidateData()?this.FetchPreference():this.InitializeGeneralDisplay()},ReinitializeGeneralDisplay:function(){this.isWorkstationPage=!1,this.removeAndHide(),this.InitializeGeneralDisplay()},InitializeCustomerDisplay:function(t){this.settingsModal=new y({el:e("#settings-modal-container"),collection:t,preferencetype:"Customer",selectedCustomer:this.preferenceCollection.at(0).get("CustomerCode")})},InitializeTaxSchemeDisplay:function(e){this.taxSchemesPreference=new O({el:this.$el,collection:e})},InitializeGeneralDisplay:function(){this.wasInitialized=void 0,l.FixRightPanelPadding();var t=this.preferenceCollection.at(0).get("CustomerName"),i=this.preferenceCollection.at(0).get("MerchantLogin"),o=this.preferenceCollection.at(0).get("PaymentType");this.preferenceCollection.at(0).set({FormattedCustomerName:l.Escapedhtml(t),MerchantLogin:i,PaymentType:o}),this.preferenceCollection.at(0).get("WebSiteDescription")||this.preferenceCollection.at(0).set({WebSiteDescription:"None"}),this.preferenceCollection.at(0).get("SalesExemptTaxCode")||this.preferenceCollection.at(0).set({SalesExemptTaxCode:"None"}),this.preferenceCollection.at(0)&&parseInt(this.preferenceCollection.at(0).get("NotificationInterval"))<a.MinimumNotificationInterval&&this.preferenceCollection.at(0).set({NotificationInterval:a.MinimumNotificationInterval}),this.$el.html(this._template(this.preferenceCollection.at(0).toJSON())),this.ToggleCheckboxes(),this.$("#settings-general").trigger("create"),a.isBrowserMode?l.UseBrowserScroll(".settings-right-pane #general-right-pane-content"):this.myScroll=new iScroll("general-right-pane-content",{onBeforeScrollStart:function(e){for(var t=e.target;1!=t.nodeType;)t=t.parentNode;"SELECT"!=t.tagName&&"INPUT"!=t.tagName&&"TEXTAREA"!=t.tagName&&e.preventDefault()}}),this.checkAirprintSetting(this.preferenceCollection.at(0).attributes),this.FetchPOSDefaultTransaction(),this.FetchImageSizeEquivalent(),!a._UserIsAdmin&&a._HasAdmins&&(e("div#settings-general").find("li").addClass("ui-disabled"),e("div#settings-general").find("li#workstation-preference-btn").removeClass("ui-disabled"))},checkAirprintSetting:function(t){a.isBrowserMode||t.IsAirprint&&e("#li-UseCashDrawer").addClass("ui-disabled")},ShowAllowChangeClassTemplate:function(){a._UserIsCS&&e("#li-AllowChangeClassTemplate").addClass("ui-screen-hidden")},InitializeLocalPreference:function(){this.localpreference||(this.localpreference=new I,this.localpreference.on("add",this.ProcessWorkstation,this)),this.localpreference.fetch({error:function(e,t,i){a.isBrowserMode||window.plugins.cbNetworkActivity.HideIndicator(),e.RequestError(t,"Error Retrieving Local Preference")}})},InitializeLocationDisplay:function(t){this.settingsModal=new y({el:e("#settings-modal-container"),collection:t,preferencetype:"Location",selectedLocation:this.preferenceCollection.at(0).get("DefaultLocation")})},InitializeShippingMethodDisplay:function(t){this.settingsModal=new y({el:e("#settings-modal-container"),collection:t,preferencetype:"ShippingMethod",selectedShippingMethod:this.preferenceCollection.at(0).get("POSShippingMethod")})},InitializeGatewayDisplay:function(t){t&&(this.settingsModal=new y({el:e("#settings-modal-container"),collection:t,preferencetype:"Gateway",selectedGateway:this.preferenceCollection.at(0).get("MerchantLogin")}))},InitializePaymentTypeDisplay:function(t){t&&(this.settingsModal=new y({el:e("#settings-modal-container"),collection:t,preferencetype:"PaymentType",selectedPaymentType:this.preferenceCollection.at(0).get("PaymentType")}))},InitializeWorkstationDisplay:function(t){t.sort(),this.settingsModal=new y({el:e("#settings-modal-container"),collection:t,preferencetype:"Workstation",selectedWorkstation:this.preferenceCollection.at(0).get("WorkstationID")})},InitializePOSDisplay:function(t){this.settingsModal=new y({el:e("#settings-modal-container"),model:t,preferencetype:"POS",general:this}),this.settingsModal.posPreference.on("selected",this.POSSelectedTransaction,this)},InitializeKioskDisplay:function(e){this.kioskPreference=new F({el:this.$el,model:e}),this.kioskPreference.general=this,this.kioskPreference.on("selected",this.KiosSelectedTransaction,this)},ClearLocalPreference:function(e){e.destroy()},FetchPOSDefaultTransaction:function(){switch(this.preferenceCollection.at(0).get("DefaultPOSTransaction")){case 0:this.$("#DefaultPOSTransaction").text("Sale");break;case 1:this.$("#DefaultPOSTransaction").text("Order");break;case 2:this.$("#DefaultPOSTransaction").text("Quote");break;case 3:this.$("#DefaultPOSTransaction").text("Return")}},POSSelectedTransaction:function(e){switch(e.selectedTransaction){case 0:this.preferenceCollection.at(0).set({DefaultPOSTransaction:0});break;case 1:this.preferenceCollection.at(0).set({DefaultPOSTransaction:1});break;case 2:this.preferenceCollection.at(0).set({DefaultPOSTransaction:2});break;case 3:this.preferenceCollection.at(0).set({DefaultPOSTransaction:3})}this.FetchPOSDefaultTransaction()},FetchCustomer:function(e,t){var i=this,o=new h,s=e;this.customerCollection||(this.customerCollection=new C,this.customerCollection.on("selected",this.SelectedCustomer,this)),o.set({StringValue:t}),o.url=a.ServiceUrl+n.CUSTOMER+r.CUSTOMERLOOKUP+s,o.save(null,{success:function(e,t){i.customerCollection.reset(t.Customers),i.customerCollection.sort(),a.isBrowserMode||window.plugins.cbNetworkActivity.HideIndicator(),t.Customers?i.InitializeCustomerDisplay(i.customerCollection):(console.log("Customer not found"),navigator.notification.alert("Customer does not exist.",null,"Customer Not Found","OK"))},error:function(e,t,i){a.isBrowserMode||window.plugins.cbNetworkActivity.HideIndicator(),e.RequestError(t,"Error Retrieving Customer")}})},FetchTaxSchemes:function(e){var t=new c;e||(e=""),this.taxSchemeCollection||(this.taxSchemeCollection=new d,this.taxSchemeCollection.on("selected",this.SelectedSalesExemptTaxCode,this)),t.on("sync",this.FetchTaxSchemeSuccess,this),t.on("error",this.FetchTaxSchemeFailed,this),t.url=a.ServiceUrl+n.CUSTOMER+r.TAXSCHEMELOOKUP+100+"/"+a.Preference.CompanyCountry,t.set({StringValue:e}),t.save()},FetchTaxSchemeSuccess:function(e,t){return a.isBrowserMode||window.plugins.cbNetworkActivity.HideIndicator(),t.ErrorMessage?void navigator.notification.alert("Fetching Tax Response : "+t.ErrorMessage,null,"Error","OK"):void(t.SystemTaxSchemes?(this.taxSchemeCollection.reset(t.SystemTaxSchemes),this.InitializeTaxSchemeDisplay(this.taxSchemeCollection)):navigator.notification.alert("Tax scheme does not exist.",null,"Tax scheme not found","OK"))},FetchTaxSchemeFailed:function(e,t,i){a.isBrowserMode||window.plugins.cbNetworkActivity.HideIndicator(),navigator.notification.alert(e,"Error Fetching Tax Schemes")},FetchLocalPreference:function(){var e=this;this.localpreference.fetch({success:function(t,i){a.isBrowserMode||window.plugins.cbNetworkActivity.HideIndicator(),t.each(e.ClearLocalPreference,this)},error:function(e,t,i){a.isBrowserMode||window.plugins.cbNetworkActivity.HideIndicator(),e.RequestError(t,"Error Retrieving Local Preference")}})},FetchLocation:function(){this.locationCollection||(this.locationCollection=new m,this.locationCollection.on("selected",this.SelectedLocation,this))},FetchShippingMethod:function(){this.shippingMethodCollection||(this.shippingMethodCollection=new k,this.shippingMethodCollection.on("selected",this.SelectedShippingMethod,this))},FetchMerchant:function(){this.gatewayCollection||(this.gatewayCollection=new w,this.gatewayCollection.on("selected",this.SelectedMerchant,this))},FetchPaymentType:function(){this.paymentTypeCollection||(this.paymentTypeCollection=new S,this.paymentTypeCollection.on("selected",this.SelectedPaymentType,this))},FetchPreference:function(){this.FetchLocation(),this.FetchMerchant(),this.FetchShippingMethod(),this.FetchPaymentType(),this.preferenceCollection||(this.preferenceCollection=new b,this.preferenceCollection.on("change:DefaultCustomer",this.ChangeCustomer,this),this.preferenceCollection.on("change:DefaultLocation",this.ChangeLocation,this),this.preferenceCollection.on("change:POSShippingMethod",this.ChangeShippingMethod,this),this.preferenceCollection.on("change:MerchantLogin",this.ChangeMerchant,this),this.preferenceCollection.on("change:PaymentType",this.ChangePaymentType,this),this.preferenceCollection.on("change:WorkstationID",this.ChangeWorkstation,this),this.preferenceCollection.on("change:SalesExemptTaxCode",this.ChangeSalesExemptTaxCode,this)),this.pickupEmailPreference||(this.pickupEmailPreference=new c);var e=this;this.preferenceCollection.url=a.ServiceUrl+n.POS+r.GETPREFERENCEBYWORKSTATION+a.POSWorkstationID,this.preferenceCollection.fetch({success:function(t,i){a.isBrowserMode||window.plugins.cbNetworkActivity.HideIndicator(),e.ResetPreferenceCollection(i.Preference),e.ResetPickupEmailPreference(i.PickupEmailPreference),e.ResetLocationCollection(i.Warehouses),e.ResetShippingMethodCollection(i.POSShippingMethods),e.ResetGatewayCollection(i.CreditCardGateways),e.ResetPaymentTypeCollection(i.PaymentType),e.ResetCategoryCollection(i.Categories),e.ResetUserRoleCollection(i.UserRoles),e.ResetStatusCollection(i.Status),e.ValidateDefaultLocation(i.Warehouses),e.ResetCustomerPreference(i.CustomerPreference)},error:function(e,t,i){a.isBrowserMode||window.plugins.cbNetworkActivity.HideIndicator(),e.RequestError(t,"Error Retrieving Workstation Preference")}})},FetchPaymentTypePreference:function(){var e=this;this.paymentTypeCollection.url=a.ServiceUrl+n.POS+"getpaymenttypebymerchant/"+a.POSWorkstationID+"/"+a.MerchantLogin,this.paymentTypeCollection.fetch({success:function(t,i){a.isBrowserMode||window.plugins.cbNetworkActivity.HideIndicator(),e.ResetPaymentTypeCollection(i.SystemPaymentTypes)},error:function(e,t,i){a.isBrowserMode||window.plugins.cbNetworkActivity.HideIndicator(),e.RequestError(t,"Error Retrieving Workstation Preference")}})},ToBeAdded:function(e){1===e&&(H.set({WorkstationID:H.get("ToBeAdded")}),X.Save())},FetchWorkstation:function(e,t,i){var o=this;a.WorkstationValue=t;var s=new h,l=e;s.set({StringValue:t}),s.url=a.ServiceUrl+n.POS+r.PREFERENCELOOKUP+l,s.save(null,{success:function(e,s){if(a.isBrowserMode||window.plugins.cbNetworkActivity.HideIndicator(),s.Preferences)switch(i){case"Add":Z=t,o.ResetWorkstation(s.Preferences);break;case"Check":o.ShowView();break;default:o.ResetWorkstation(s.Preferences)}else switch(i){case"Add":H=o.preferenceCollection.at(0),H.set({ToBeAdded:t},{silent:!0}),navigator.notification.confirm("The Workstation ID you entered doesn't exist. Instead would you like it to be added as a new Workstation?",o.ToBeAdded,"Workstation ID doesn't exist.",["Yes","No"]);break;case"Check":a.POSWorkstationID="Test",o.ShowView();break;default:Z=t,o.ResetWorkstation(s.Preferences)}},error:function(e,t,i){a.isBrowserMode||window.plugins.cbNetworkActivity.HideIndicator(),e.RequestError(t,"Error Retrieving Workstation")}})},FetchWebsite:function(e,t){var i=this,o=new u;o.url=a.ServiceUrl+n.POS+r.ECOMMERCESITELOOKUP+e,this.websiteCollection||(this.websiteCollection=new g,this.websiteCollection.on("selected",this.SaveWebsiteSelected,this)),o.set({StringValue:t}),o.save(null,{success:function(e,t){if(a.isBrowserMode||window.plugins.cbNetworkActivity.HideIndicator(),!i.preferenceCollection.at(0).get("IsUseISEImage")){var o=t.EcommerceSites.length;t.EcommerceSites[o]={WebSiteDescription:"None",WebSiteURL:null,WebSiteCode:null,ErrorMessage:null,WebServiceURL:null}}i.websiteCollection.reset(t.EcommerceSites),i.ValidateCollection(i.websiteCollection)},error:function(e,t,i){a.isBrowserMode||window.plugins.cbNetworkActivity.HideIndicator(),e.RequestError(t,"Error Retrieving Websites")}})},SaveWebsiteSelected:function(e){_previousValue=this.preferenceCollection.at(0).get("WebSiteCode"),_previousValue!==e.get("WebsiteCode")&&(this.preferenceCollection.at(0).set({WebSiteCode:e.get("WebSiteCode"),WebSiteDescription:e.get("WebSiteDescription"),WebSiteURL:e.get("WebSiteURL")}),this.removeAndHide(),this.InitializeGeneralDisplay(),this.CloseModal())},ValidateCollection:function(e){0===e.length?this.NotifyMsg("No Website found.","No Website Found."):this.ShowWebsitePage(e)},ShowWebsitePage:function(t){this.settingsModal=new y({el:e("#settings-modal-container"),collection:t,preferencetype:"Website",selectedWebsite:this.preferenceCollection.at(0).get("WebSiteCode")})},ResetWorkstation:function(e){this.workstationCollection||(this.workstationCollection=new P,this.workstationCollection.on("selected",this.SelectedWorkstation,this)),this.workstationCollection.reset(e),this.workstationCollection.sort(),this.InitializeWorkstationDisplay(this.workstationCollection)},ResetCategoryCollection:function(e){this.categoryCollection||(this.categoryCollection=new f),this.categoryCollection.reset(e)},ResetUserRoleCollection:function(e){if(this.userRoleCollection||(this.userRoleCollection=new T),this.userRoleCollection.reset(e),e.length>0)for(var t=0;t<e.length;t++)e[t].RoleCode==a.UserInfo.RoleCode&&(a._UserIsAdmin=!0,a.AdministratorRole=!0)},ResetStatusCollection:function(e){a.IsWorkstationIDStillOpen=e.IsOpen,a.Status=e},ResetPreferenceCollection:function(e){this.preferenceCollection.reset(e),a.Preference=e,a.Preference.AutoSignOutUser=!0,a.PrintOptions.CustomizePrint=e.IsAirprint,a.CardDeviceType=e.CardDeviceType,this.InitializeGeneralDisplay()},ResetLocationCollection:function(e){this.locationCollection.reset(e)},ResetShippingMethodCollection:function(e){this.shippingMethodCollection.reset(e)},ResetGatewayCollection:function(e){this.gatewayCollection.reset(e)},ResetPaymentTypeCollection:function(e){this.paymentTypeCollection.reset(e)},ResetCustomerPreference:function(e){this.customerPreference||(this.customerPreference=new c),this.customerPreference.set(e)},ResetPickupEmailPreference:function(e){this.pickupEmailPreference||(this.pickupEmailPreference=new c);var t;e&&(this.pickupEmailPreference.set(e),t=this.pickupEmailPreference.get("B64EmailTemplate")||""),e&&t||this.pickupEmailPreference.set({B64EmailTemplate:Base64.encode(this._defaultMessageTemplate())}),a.PickupEmailPreference=this.pickupEmailPreference},ConvertDefaultTransaction:function(){var e=[];switch(a.Preference.DefaultPOSTransaction){case 0:e[0]="Sale";break;case 1:e[0]="Order";break;case 2:e[0]="Quote";break;case 3:e[0]="Return"}return e},AllowTransactionChange:function(e){for(var t=["AllowSales","AllowOrders","AllowQuotes","AllowReturns"],i=[this.preferenceCollection.at(0).get("DefaultPOSTransaction")],o=!1,s=[],a=["POS","Kiosk"],n=0;n<i.length;n++){if(t[i[n]]!=e)return!0;switch(t[i[n]]){case"AllowSales":o=null==_?this.preferenceCollection.at(0).attributes.AllowSales:_;break;case"AllowOrders":o=null==V?this.preferenceCollection.at(0).attributes.AllowOrders:V;break;case"AllowQuotes":o=null==N?this.preferenceCollection.at(0).attributes.AllowQuotes:N;break;case"AllowReturns":o=null==z?this.preferenceCollection.at(0).attributes.AllowReturns:z}if(!o){switch(e){case"AllowSales":_=!0,this.ToggleCheckbox(e,!0);break;case"AllowQuotes":N=!0,this.ToggleCheckbox(e,!0);break;case"AllowOrders":V=!0,this.ToggleCheckbox(e,!0);break;case"AllowReturns":z=!0,this.ToggleCheckbox(e,!0)}return s=this.ConvertDefaultTransaction(),this.NotifyMsg(s[n]+" Transaction is used as Default "+a[n]+" Transaction.","Action Not Allowed"),!1}t=["AllowOrders","AllowSales"]}},CheckTransactionState:function(e,t){var i=this.preferenceCollection.at(0),o=!1;if(this.AllowTransactionChange(t)){switch(t){case"AllowSales":o=_,i.set({AllowSales:o}),a.Preference.AllowSales=o,this.ToggleCheckbox(t,o);break;case"AllowQuotes":o=N,i.set({AllowQuotes:o}),a.Preference.AllowQuotes=o,this.ToggleCheckbox(t,o);break;case"AllowOrders":o=V,i.set({AllowOrders:o}),a.Preference.AllowOrders=o,this.ToggleCheckbox(t,o);break;case"AllowReturns":o=z,i.set({AllowReturns:o}),a.Preference.AllowReturns=o,this.ToggleCheckbox(t,o)}"UseForcePayment"==t&&i.set({UseForcePayment:useForcePayment})}},ToggleCheckboxes:function(){
var e=this.preferenceCollection.at(0),t=["AllowSales","AllowQuotes","AllowOrders","AllowReturns","AllowChangePrice","AllowAddCustomer","TaxByLocation","ShowCouponList","IsUseItemDescription","IsDepositPayment","IsOverrideSalesRep","ShowWholesalePrice","AutoSignOutUser","TrackDrawerBalance","BlindClose","UseCashDrawer","IsUseISEImage","AllowChangeClassTemplate","AllowTaxOnLineItems","AskForPaymentTerm","AskForShippingMethod","AskForContact","AskForCustomerPO","AskForShipDate","AskForSource","IsTrackStorePickUp","AllowChangePaymentTerm","AllowChangeTaxCode","IsUseCustomerShipToPaymentType","IsUsePOSShippingMethod","UseForcePayment","IsAllowViewZXTape","IsAutoAdjustmentStock"],o=this;i.each(t,function(t){switch(t){case"AllowSales":_=e.attributes.AllowSales;break;case"AllowQuotes":N=e.attributes.AllowQuotes;break;case"AllowOrders":V=e.attributes.AllowOrders;break;case"AllowReturns":z=e.attributes.AllowReturns;break;case"AllowChangePrice":this.allowChangePrice=e.attributes.AllowChangePrice;break;case"AllowChangePaymentTerm":this.allowChangePaymentTerm=e.attributes.AllowChangePaymentTerm;break;case"AllowChangeTaxCode":this.allowChangeTaxCode=e.attributes.AllowChangeTaxCode;break;case"AllowAddCustomer":this.allowAddCustomer=e.attributes.AllowAddCustomer;break;case"TaxByLocation":this.taxByLocation=e.attributes.TaxByLocation;break;case"ShowCouponList":this.showCouponList=e.attributes.ShowCouponList;break;case"IsUseItemDescription":this.isUseItemDescription=e.attributes.IsUseItemDescription;break;case"IsDepositPayment":this.isDepositPayment=e.attributes.IsDepositPayment;break;case"IsOverrideSalesRep":this.isOverrideSalesRep=e.attributes.IsOverrideSalesRep;break;case"ShowWholesalePrice":this.showWholesalePrice=e.attributes.ShowWholesalePrice;break;case"AutoSignOutUser":this.autoSignOutUser=e.attributes.AutoSignOutUser;break;case"TrackDrawerBalance":this.trackDrawerBalance=e.attributes.TrackDrawerBalance;break;case"BlindClose":this.blindClose=e.attributes.BlindClose;break;case"UseCashDrawer":this.useCashDrawer=e.attributes.UseCashDrawer;break;case"IsUseISEImage":this.isUseISEImage=e.attributes.IsUseISEImage;break;case"AllowChangeClassTemplate":this.allowChangeClassTemplate=e.attributes.AllowChangeClassTemplate;break;case"AllowTaxOnLineItems":this.allowTaxOnLineItems=e.attributes.AllowTaxOnLineItems;break;case"AskForPaymentTerm":this.askForPaymentTerm=e.attributes.AskForPaymentTerm;break;case"AskForShippingMethod":this.askForShippingMethod=e.attributes.AskForShippingMethod;break;case"AskForContact":this.askForContact=e.attributes.AskForContact;break;case"AskForCustomerPO":this.askForCustomerPO=e.attributes.AskForCustomerPO;break;case"AskForShipDate":this.askForShipDate=e.attributes.AskForShipDate;break;case"AskForSource":this.askForSource=e.attributes.AskForSource;break;case"IsTrackStorePickUp":this.trackStorePickUp=e.attributes.IsTrackStorePickUp;break;case"IsUseCustomerShipToPaymentType":this.isUseCustomerShipToPaymentType=e.attributes.IsUseCustomerShipToPaymentType;break;case"IsUsePOSShippingMethod":this.isUsePOSShippingMethod=e.attributes.IsUsePOSShippingMethod;break;case"UseForcePayment":this.useForcePayment=e.attributes.UseForcePayment;break;case"IsAllowViewZXTape":this.isAllowViewZXTape=e.attributes.IsAllowViewZXTape;break;case"IsAutoAdjustmentStock":this.isAutoAdjustmentStock=e.attributes.IsAutoAdjustmentStock}e.get(t)?o.SetChkState(t,!0):o.SetChkState(t,!1)})},SelectedCustomer:function(e){var t=this.preferenceCollection.at(0);console.log("Previous: "+t.get("DefaultCustomer")),t.set({DefaultCustomer:e.get("CustomerCode"),CustomerCode:e.get("CustomerCode"),CustomerName:e.get("CustomerName")}),this.CloseModal()},SelectedSalesExemptTaxCode:function(e){var t=this.preferenceCollection.at(0);t.set({SalesExemptTaxCode:e.get("TaxCode")})},ChangeCustomer:function(e){console.log("Default: "+e.get("DefaultCustomer")+" Name :"+e.get("CustomerName")),a.CustomerCode=e.get("CustomerCode"),a.CustomerName=e.get("CustomerName"),this.removeAndHide(),this.InitializeGeneralDisplay()},ChangeSalesExemptTaxCode:function(e){this.removeAndHide(),this.InitializeGeneralDisplay()},SelectedLocation:function(e){var t=this.preferenceCollection.at(0);console.log("Previous: "+t.get("DefaultLocation")),t.set({DefaultLocation:e.get("WarehouseCode")}),this.CloseModal()},SelectedShippingMethod:function(e){var t=this.preferenceCollection.at(0);console.log("Previous: "+t.get("ShippingMethodCode")),t.set({POSShippingMethod:e.get("ShippingMethodCode")}),this.CloseModal()},SelectedMerchant:function(e){var t=this.preferenceCollection.at(0);t.set({MerchantLogin:e.get("MerchantLogin")}),this.CloseModal()},SelectedPaymentType:function(e){var t=this.preferenceCollection.at(0);t.set({PaymentType:e.get("PaymentTypeCode")}),this.CloseModal()},ChangeLocation:function(e){console.log("Default:"+e.get("DefaultLocation")),a.LocationCode=e.get("DefaultLocation"),this.removeAndHide(),this.InitializeGeneralDisplay()},ChangeShippingMethod:function(e){console.log("Default:"+e.get("POSShippingMethod")),a.ShippingMethod=e.get("POSShippingMethod"),this.removeAndHide(),this.InitializeGeneralDisplay()},ChangeMerchant:function(e){this.removeAndHide(),a.MerchantLogin=e.get("MerchantLogin"),this.InitializeGeneralDisplay(),this.FetchPaymentTypePreference(),this.preferenceCollection.at(0).set("PaymentType","")},ChangePaymentType:function(e){this.removeAndHide(),this.InitializeGeneralDisplay()},SelectedWorkstation:function(e){var t=this.preferenceCollection.at(0),i=(this.preferenceCollection.at(0).get("TrackDrawerBalance"),e.get("WorkstationID")!==t.get("WorkstationID"));a.IsWorkstationIDStillOpen&&i&&null!==a.PreviousWorkstationID?navigator.notification.alert("Unable to change WorkstationID. The current Workstation ("+t.get("WorkstationID")+") is still open. Please close the current workstation before switching to new workstation.",null,"Workstation Still Open","OK"):(i||null!==a.PreviousWorkstationID)&&(a.POSWorkstationID=e.get("WorkstationID"),t.set({WorkstationID:e.get("WorkstationID")},{silent:!0}),this.removeAndHide(),this.FetchPreference(),this.CloseModal())},CloseModal:function(){null!=this.settingsModal&&this.settingsModal.close()},ChangeWorkstation:function(e){if(a.BackToGeneralTriggered)return a.BackToGeneralTriggered=!1,void(a.POSWorkstationID=e.get("WorkstationID"));X=this;this.preferenceCollection.at(0);a.POSWorkstationID=e.get("WorkstationID");var t=a.PreviousWorkstationID===e.get("WorkstationID");if(a.IsWorkstationIDStillOpen)if(null===a.PreviousWorkstationID||t)this.removeAndHide(),this.InitializeGeneralDisplay();else{var i="Unable to change WorkstationID. The current Workstation ("+a.PreviousWorkstationID+") is still open. Please close the current workstation before switching to new workstation.";this.NotifyMsg(i,"Cannot change Workstation.")}else this.removeAndHide(),this.InitializeGeneralDisplay()},RevertToPreviousWorkstation:function(){a.PreviousWorkstationID;console.log("unbind.Global.PreviousWorkstationID : "+a.PreviousWorkstationID),this.preferenceCollection.at(0).set({WorkstationID:a.PreviousWorkstationID},{silent:!0}),this.FetchWorkstation(100,""),console.log(X.preferenceCollection.at(0).get("WorkstationID")+"<<")},CheckIfWorkstationExist:function(e){this.FetchWorkstation(100,e,"Add")},SaveWorkStationID:function(e){X=this,H=X.preferenceCollection.at(0),H.set({ToBeAdded:e},{silent:!0}),this.ToBeAdded(1),this.CloseModal()},AddWorkstation:function(e){var t=this.preferenceCollection.at(0);console.log("Previous: "+t.get("WorkstationID")),t.set({WorkstationID:e})},SaveLocalPreference:function(){var e=this.preferenceCollection.at(0);this.FetchLocalPreference(),this.localpreference.create({WorkstationID:e.get("WorkstationID"),IsUseCustomerShipToPaymentType:e.get("IsUseCustomerShipToPaymentType"),IsUsePOSShippingMethod:e.get("IsUsePOSShippingMethod"),POSShippingMethod:e.get("POSShippingMethod"),PaymentType:e.get("PaymentType"),UseForcePayment:e.get("UseForcePayment")})},Save:function(){if(this.preferenceCollection){if((!a._HasStations||a._HasAdmins)&&0==this.userRoleCollection.length){var e={UserCode:"",RoleCode:a.UserInfo.RoleCode,Message:"",AppVersion:"",Selected:!0};this.userRoleCollection.add(e)}if(this.UpdateCollection(),this.ValidateData()){this.UpdateCollection(),this.SaveLocalPreference(),this.pickupEmailPreference.set({WorkstationID:this.preferenceCollection.at(0).get("WorkstationID")});var t=new p;t.set({Preference:this.preferenceCollection.at(0),Categories:this.categoryCollection,UserRoles:this.userRoleCollection,Warehouses:this.locationCollection,POShippingMethods:this.shippingMethodCollection,PickupEmailPreference:this.pickupEmailPreference});var i=this;t.url=a.ServiceUrl+n.POS+r.UPDATEPREFERENCE,t.save(null,{success:function(e,t){a.isBrowserMode||window.plugins.cbNetworkActivity.HideIndicator(),a.Preference=t.Preference,X.isValid=!0,X.preventSaveCompleted?X.preventSaveCompleted=!1:(i.preventSaveCompleted=!1,i.SaveCompleted())},error:function(e,t,i){a.isBrowserMode||window.plugins.cbNetworkActivity.HideIndicator(),e.RequestError(t,"Error Updating Preference")}})}else this.isRedirectToReceipts?(this.isValid=!0,console.log("PASSED Validation: "+this.isValid)):(this.isValid=!1,console.log("Failed Validation: "+this.isValid))}},SaveCompleted:function(){a.isBrowserMode||window.plugins.cbNetworkActivity.HideIndicator();var t=this.preferenceCollection.at(0).get("WorkstationID");this.isValid=!0;var i=e("#settings-website-search");i.is(":visible")&&i.remove(),a.IsWorkstationIDStillOpen&&this.isWorkstationPage&&!a.BackToMain?null===a.PreviousWorkstationID||a.PreviousWorkstationID===t?this.trigger("SaveCompleted",this):(console.log("RevertToPreviousWorkStation"),this.RevertToPreviousWorkstation()):(this.isWorkstationPage=!1,this.trigger("SaveCompleted",this))},UpdateCollection:function(){var e=this.preferenceCollection.at(0),t=["AllowSales","AllowQuotes","AllowOrders","AllowReturns","AllowChangePrice","AllowAddCustomer","TaxByLocation","ShowCouponList","IsUseItemDescription","IsDepositPayment","IsOverrideSalesRep","ShowWholesalePrice","AutoSignOutUser","TrackDrawerBalance","BlindClose","UseCashDrawer","AllowChangeClassTemplate","AllowTaxOnLineItems","AskForPaymentTerm","AskForShippingMethod","AskForContact","AskForCustomerPO","AskForShipDate","AskForSource","IsTrackStorePickUp","AllowChangePaymentTerm","AllowChangeTaxCode","IsUseCustomerShipToPaymentType","IsUsePOSShippingMethod","UserForcePayment","IsAllowViewZXTape","IsAutoAdjustmentStock"];i.each(t,function(t){var i=!1;switch(t){case"AllowSales":i=_,e.set({AllowSales:i}),a.Preference.AllowSales=i;break;case"AllowQuotes":i=N,e.set({AllowQuotes:i}),a.Preference.AllowQuotes=i;break;case"AllowOrders":i=V,e.set({AllowOrders:i}),a.Preference.AllowOrders=i;break;case"AllowReturns":i=z,e.set({AllowReturns:i}),a.Preference.AllowRetruns=i;break;case"AllowChangePrice":i=this.allowChangePrice,e.set({AllowChangePrice:i});break;case"AllowChangePaymentTerm":i=this.allowChangePaymentTerm,e.set({AllowChangePaymentTerm:i});break;case"AllowChangeTaxCode":i=this.allowChangeTaxCode,e.set({AllowChangeTaxCode:i});break;case"AllowAddCustomer":i=this.allowAddCustomer,e.set({AllowAddCustomer:i});break;case"TaxByLocation":i=this.taxByLocation,e.set({TaxByLocation:i});break;case"ShowCouponList":i=this.showCouponList,e.set({ShowCouponList:i});break;case"IsUseItemDescription":i=this.isUseItemDescription,e.set({IsUseItemDescription:i});break;case"IsDepositPayment":i=this.isDepositPayment,e.set({IsDepositPayment:i});break;case"IsUseCustomerShipToPaymentType":i=this.isUseCustomerShipToPaymentType,e.set({IsUseCustomerShipToPaymentType:i});break;case"IsUsePOSShippingMethod":i=this.isUsePOSShippingMethod,e.set({IsUsePOSShippingMethod:i});break;case"UseForcePayment":i=this.useForcePayment,e.set({UseForcePayment:i});break;case"IsAllowViewZXTape":i=this.isAllowViewZXTape,e.set({IsAllowViewZXTape:i});break;case"IsOverrideSalesRep":i=this.isOverrideSalesRep,e.set({IsOverrideSalesRep:i});break;case"ShowWholesalePrice":i=this.showWholesalePrice,e.set({ShowWholesalePrice:i});break;case"AutoSignOutUser":i=this.autoSignOutUser,e.set({AutoSignOutUser:i});break;case"TrackDrawerBalance":i=this.trackDrawerBalance,e.set({TrackDrawerBalance:i}),a.TrackDrawerBalance=i;break;case"BlindClose":i=this.blindClose,e.set({BlindClose:i}),a.Preference.BlindClose=i;break;case"UseCashDrawer":i=this.useCashDrawer,e.set({UseCashDrawer:i});break;case"IsUseISEImage":i=this.isUseISEImage,e.set({IsUseISEImage:i});break;case"AllowChangeClassTemplate":i=this.allowChangeClassTemplate,e.set({AllowChangeClassTemplate:i});break;case"AllowTaxOnLineItems":i=this.allowTaxOnLineItems,e.set({AllowTaxOnLineItems:i});break;case"AskForPaymentTerm":i=this.askForPaymentTerm,e.set({AskForPaymentTerm:i});break;case"AskForShippingMethod":i=this.askForShippingMethod,e.set({AskForShippingMethod:i});break;case"AskForContact":i=this.askForContact,e.set({AskForContact:i});break;case"AskForCustomerPO":i=this.askForCustomerPO,e.set({AskForCustomerPO:i});break;case"AskForShipDate":i=this.askForShipDate,e.set({AskForShipDate:i});break;case"AskForSource":i=this.askForSource,e.set({AskForSource:i});break;case"IsTrackStorePickUp":i=this.trackStorePickUp,e.set({IsTrackStorePickUp:i});break;case"IsAutoAdjustmentStock":i=this.isAutoAdjustmentStock,e.set({IsAutoAdjustmentStock:i})}}),this.preferenceCollection.reset(e)},isRedirectToReceipts:!1,ValidateData:function(){if(!this.preferenceCollection)return!0;var e=this.preferenceCollection.at(0);return e.get("WorkstationID")?e.get("DefaultCustomer")?e.get("IsUseCustomerShipToPaymentType")||e.get("PaymentType")?e.get("IsUsePOSShippingMethod")&&!e.get("POSShippingMethod")?(navigator.notification.alert("Default Shipping Method must not be empty.",null,"Default Shipping Method is Required","OK"),a.BackToMain=!1,!1):e.get("DefaultLocation")?!e.get("IsUseISEImage")||null!==e.get("WebSiteCode")&&void 0!==e.get("WebSiteCode")&&""!==e.get("WebSiteCode")?!(!a.isBrowserMode&&e.get("UseCashDrawer")&&l.IsNullOrWhiteSpace(a.Printer.IpAddress)&&l.IsNullOrWhiteSpace(a.Printer.PrinterModel))||(this.isRedirectToReceipts?(this.preventSaveCompleted=!0,this.isRedirectToReceipts=!1,!0):void navigator.notification.confirm("You must set the printer IP first in order to enable Use Cash Drawer. Would you like to be redirected to the Receipt settings instead?.",X.goToReceipts,"Required Action","Yes,No")):(this.NotifyMsg("The CBE Image is turned ON. Please specify a website first.","Website is Required"),a.BackToMain=!1,!1):(console.log("Default Location must not be null"),navigator.notification.alert("Default Location must not be empty.",null,"Default Location is Required","OK"),a.BackToMain=!1,!1):(navigator.notification.alert("Default Payment Type must not be empty.",null,"Default Payment Type is Required","OK"),a.BackToMain=!1,!1):(console.log("Default Customer must not be null"),navigator.notification.alert("Default Customer must not be empty.",null,"Default Customer is Required","OK"),a.BackToMain=!1,!1):(console.log("WorkstationID must not be null"),navigator.notification.alert("Workstation ID must not be empty.",null,"Workstation ID is Required","OK"),a.BackToMain=!1,!1)},ForceCloseWorkstationConfirmation:function(e){return 1!==e?(a.Preference.TrackDrawerBalance=!0,void X.SetChkState("TrackDrawerBalance",!0)):(a.Preference.TrackDrawerBalance=!1,a.Preference.UseCashDrawer===!0&&(a.isOkToOpenCashDrawer=!0),!a.Preference.TrackDrawerBalance&&a.Status.IsOpen&&(X.preventSaveCompleted=!0,X.UpdateCollection(),X.Save(),a.ClosingWorkStation=!0,X.trigger("showClosingAmount",X)),void 0)},EnableISEImageSettings:function(t){t?(e("#image-size-preference-btn").removeClass("ui-disabled"),e("#IsUseISEImageLabel").css("background-color","#E2E2E2")):(e("#image-size-preference-btn").addClass("ui-disabled"),e("#image-size-preference-btn").css("opacity","1"),e("#IsUseISEImageLabel").css("background-color","#FFF")),this.preferenceCollection.at(0).set({IsUseISEImage:t})},IsWebSiteURLSpecified:function(){var e=this.preferenceCollection.at(0).get("IsUseISEImage");if(e){var t=this.preferenceCollection.at(0).get("WebSiteCode");return null!==t&&void 0!==t&&""!==t||(this.NotifyMsg("The CBE Image is Turned ON. Please specify a website first.","Website is Required"),!1)}return!0},ValidateDefaultLocation:function(e){var t=this.preferenceCollection.at(0),o=t.get("DefaultLocation"),s=i.pluck(e,"WarehouseCode"),n=i.contains(s,o);n?a.ValidLocation=!0:(this.NotifyMsg("The Current Status of the Default Location is Inactive. Please change your Default Location.","Invalid Location"),a.ValidLocation=!1)},NotifyMsg:function(e,t){console.log(e),navigator.notification.alert(e,null,t,"OK")}});return G});