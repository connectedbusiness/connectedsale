define(["jquery","mobile","underscore","backbone","shared/global","shared/service","shared/method","shared/shared","collection/useraccounts","model/lookupcriteria","model/useraccount","view/20.1.0/settings/user/userlist/userlist","view/20.1.0/settings/user/usermaintenance/adduser","view/20.1.0/settings/user/usermaintenance/maintainuser","view/20.1.0/settings/modal/modal","text!template/20.1.0/settings/user/user.tpl.html"],function(e,t,i,s,n,o,r,a,c,l,d,h,u,g,w,m){var f=s.View.extend({_template:i.template(m),render:function(){this.InitializeDisplay(),this.FetchUserAccounts("")},InitializeDisplay:function(){this.SetSelectedPage("User"),this.$el.html(this._template()),this.$el.trigger("create"),this.EditMode=!1,this.AddMode=!1,this.HasChanges=!1},FetchUserAccounts:function(e){var t=new l,i=100;this.userAccountCollection||(this.userAccountCollection=new c,this.userAccountCollection.on("selected",this.GetItemSelected,this)),t.set({StringValue:e,ProductEdition:n.ProductType}),t.on("sync",this.ResetUserAccountCollection,this),t.on("error",this.FetchSaveError,this),t.url=n.ServiceUrl+o.POS+r.USERACCOUNTLOOKUP+i,t.save()},FetchSaveError:function(e,t,i){n.isBrowserMode||window.plugins.cbNetworkActivity.HideIndicator(),e.RequestError(t,"Error Fetching User Accounts")},InitializeUserListView:function(){this.userListView=new h({el:this.$el,collection:this.userAccountCollection})},InitializeUserMaintenanceView:function(){this.settingsModal=new w({el:e("#settings-modal-container"),model:this.model,preferencetype:"UserMaintenance",general:this}),this.settingsModal.on("ModalClose",this.RemoveClassOnModal,this),this.settingsModal.maintainUserView.on("userUpdated",this.ResetDisplay,this),this.settingsModal.maintainUserView.on("userDeleted",this.ResetDisplay,this),this.settingsModal.maintainUserView.on("attributeChanged",this.SetHasChanged,this)},RemoveClassOnModal:function(){e("#settings-modal-container").removeClass("settings-modal-userMaintenance-template")},CloseModal:function(){null!=this.settingsModal&&this.settingsModal.close()},SetHasChanged:function(){this.HasChanges=!0},InitializeAddUserView:function(){this.AddMode=!0,this.HasChanges=!0,a.FixRightPanelPadding(),this.settingsModal=new w({el:e("#settings-modal-container"),model:this.model,preferencetype:"UserAdd"}),this.settingsModal.addUserView.on("NewUserAdded",this.ResetDisplay,this)},ResetUserAccountCollection:function(e,t,i){return n.isBrowserMode||window.plugins.cbNetworkActivity.HideIndicator(),t.ErrorMessage?void this.NotifyMsg(t.ErrorMessage,"Error Retrieving User Accounts"):(this.userAccountCollection.reset(t.UserAccounts),this.InitializeUserListView(),0===this.userAccountCollection.length?void this.NotifyMsg("No user record found!","No Record."):void 0)},ReinitiazeUserView:function(){},ResetDisplay:function(){this.InitializeDisplay(),this.FetchUserAccounts(""),this.CloseModal()},Save:function(){this.SaveCompleted()},initialize:function(){this.on("addNewUserView",this.InitializeAddUserView,this),this.on("searchUser",this.FetchUserAccounts,this),this.render()},SetSelectedPage:function(e){this.selectedPage=e},SaveCompleted:function(e,t,i){n.isBrowserMode||window.plugins.cbNetworkActivity.HideIndicator(),this.trigger("SaveCompleted",this)},SaveFailed:function(e,t,i){n.isBrowserMode||window.plugins.cbNetworkActivity.HideIndicator(),e.RequestError(t,"Error Saving Workstation Preference")},RemoveSearchTemplate:function(){e("#search-user").remove(),e("#back-general").hide()},NotifyMsg:function(e,t){console.log(e),navigator.notification.alert(e,null,t,"OK")},GetItemSelected:function(e){this.model||(this.model=new d),this.model.set(e.attributes),this.InitializeUserMaintenanceView()}});return f});