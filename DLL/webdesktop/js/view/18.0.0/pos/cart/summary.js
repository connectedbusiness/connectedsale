define(["jquery","mobile","underscore","backbone","model/base","shared/enum","shared/global","shared/method","shared/shared","shared/service","text!template/16.0.0/pos/cart/summary.tpl.html"],function(e,t,a,n,i,r,o,s,c,l,T){var d=n.View.extend({_template:a.template(T),events:{"tap #view-payment":"payment_tap","tap #view-notes":"ordernotes_tap","tap #view-signature":"signature_tap","tap #view-tax":"taxList_tap","tap .taxqs":"showTaxName"},attributes:{id:"summary"},initialize:function(){this.type=this.options.type,this.model.bind("change",this.render,this)},render:function(){return this.RecomputeBalance(),this.model.set({CurrencySymbol:o.CurrencySymbol}),this.LoadCompanyImg(),this.$el.html(this._template(this.model.attributes)),this.ToggleFields(),o.Preference.AllowChangeTaxCode||e("#view-tax").attr("style","color: #666; cursor: default"),this},RecomputeBalance:function(){if(!this.model)return 0;var e=parseFloat(this.model.Balance()),t=e;o.TransactionType==r.TransactionType.ConvertOrder&&e<0&&(t=0),this.model.set({Balance:t},{silent:!0})},LoadCompanyImg:function(){var e=o.ServiceUrl+s.COMPANYIMAGE+o.CompanyName+".png";this.model.set({ImageLocation:e},{silent:!0})},payment_tap:function(e){e.preventDefault(),this.ViewPayments()},signature_tap:function(e){e.preventDefault(),this.ViewSignature()},ordernotes_tap:function(e){e.preventDefault(),this.LoadOrderNotes()},taxList_tap:function(e){o.Preference.AllowChangeTaxCode&&o.TransactionType!=r.TransactionType.SalesRefund&&o.TransactionType!=r.TransactionType.SalesPayment&&(e.preventDefault(),this.ViewTaxOverrideList())},ViewPayments:function(){this.trigger("viewPayments",this)},ViewTaxOverrideList:function(){this.trigger("viewTaxOverrideList",this)},ToggleFields:function(){var e=o.TransactionType!=r.TransactionType.Order&&o.TransactionType!=r.TransactionType.ConvertInvoice&&o.TransactionType!=r.TransactionType.UpdateOrder&&o.TransactionType!=r.TransactionType.ConvertQuote&&o.TransactionType!=r.TransactionType.Sale&&o.TransactionType!=r.TransactionType.UpdateInvoice&&o.TransactionType!=r.TransactionType.ResumeSale&&o.TransactionType!=r.TransactionType.Quote&&o.TransactionType!=r.TransactionType.UpdateQuote;this.ToggleOrderNotes(e),o.TransactionType===r.TransactionType.SalesRefund&&(this.$(".summary-right").children("div:last-child").hide(),this.$(".summary-right").find("#view-tax").attr("style","color: #666; cursor: default;")),o.TransactionType===r.TransactionType.SalesPayment&&this.$(".summary-right").find("#view-tax").attr("style","color: #666; cursor: default;")},ViewSignature:function(){this.trigger("viewSignature",this)},ToggleOrderNotes:function(e){},LoadOrderNotes:function(){this.trigger("loadOrderNotes","OrderNotes")},showTaxName:function(e){e.preventDefault();var t=window.sessionStorage.getItem("selected_taxcode");t=t?t:o.ShipTo.TaxCode,this.$(e.currentTarget).find(".taxpopover").html(t).show().delay(2e3).fadeOut()},LoadWarehouseTaxCode:function(){var e=new i;e.url=o.ServiceUrl+l.SOP+s.GETLOCATIONTAXCODE+o.DefaultLocation+"/"+o.CustomerCode,e.fetch({success:function(e,t,a){console.log(t)}.bind(this),error:function(e,t,a){console.log(t)}.bind(this)})}});return d});