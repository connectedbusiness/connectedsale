define(["backbone","shared/global","shared/service","shared/method","model/base","model/lookupcriteria","collection/base","view/16.0.0/products/category/details","view/16.0.0/products/category/detail/addcategory","view/16.0.0/products/controls/generic-list","text!template/16.0.0/products/category/categories.tpl.html","text!template/16.0.0/products/controls/generic-layout.tpl.html"],function(e,t,i,o,s,a,r,n,h,c,d,l){var g="",w=function(e){1===e&&g.LoadSearchItem()},y=function(e){1===e&&g.LoadSelectedItem()},m={SearchInput:"#txt-search",CategoryForm:"#categories-form"},L=e.View.extend({_categoriesFormTemplate:_.template(d),_genericLayoutTemplate:_.template(l),initialize:function(){},render:function(){return this.$el.html(this._categoriesFormTemplate),this.$(m.CategoryForm).html(this._genericLayoutTemplate),g=this,this},btnSearch:function(e){this.LoadItems($(m.SearchInput).val())},Show:function(){this.LoadItems(),this.render()},InitializeCategoryLookUp:function(){this.categoryLookUp||(this.categoryLookUp=new a,this.categoryLookUp.on("sync",this.CategoryLookUpLoadSuccess,this),this.categoryLookUp.on("error",this.CategoryLookUpLoadError,this))},CategoryLookUpLoadSuccess:function(e,i,o){t.isBrowserMode||window.plugins.cbNetworkActivity.HideIndicator(),this.categories=new r,this.categories.reset(i.SystemCategories),this.DisplayItemList()},HasChanges:function(){if(t.FormHasChanges)return this.UnloadConfirmationMessage="Do you want to cancel Adding new Category?",!0},AddCategory:function(){t.FormHasChanges===!1&&(this.IsNullOrWhiteSpace(this.addnewCategory)||this.addnewCategory.unbind(),this.addnewCategory=new h({el:$("#right-panel")}),this.addnewCategory.InitializeChildViews(),this.addnewCategory.BindToForm(this),t.FormHasChanges=!0)},CategoryLookUpLoadError:function(e,i,o){t.isBrowserMode||window.plugins.cbNetworkActivity.HideIndicator()},IsNullOrWhiteSpace:function(e){return!e||(""===e||null===e||void 0===e)},LoadItems:function(e,s){this.IsNullOrWhiteSpace(s)||(this.isNewLyAdded=!0,this.newModel=s),this.InitializeCategoryLookUp();var a=1e3;this.categoryLookUp.clear(),this.categoryLookUp.set({StringValue:e});this.categoryLookUp.url=t.ServiceUrl+i.PRODUCT+o.GETCATEGORYDETAILS+a,this.categoryLookUp.save()},GetFirstItem:function(){var e=new s;this.IsNullOrWhiteSpace(this.isNewLyAdded)&&1!=this.isNewLyAdded?e=this.genericListView.GetFirstModel():e.set(this.newModel),this.IsNullOrWhiteSpace(this.categoryDetailView)||this.categoryDetailView.unbind(),this.categoryDetailView=new n({el:$("#right-panel"),model:e,IsReadOnly:this.options.IsReadOnly}),this.categoryDetailView.toBeSearched=this.genericListView.GetItemToSearch(),this.categoryDetailView.BindToForm(this),this.categoryDetailView.InitializeChildViews(),this.isNew=!1,this.IsNullOrWhiteSpace(this.isNewLyAdded)&&1!=this.isNewLyAdded||this.SelectNewlyAddedItem()},DisplayItemList:function(){this.genericListView?this.genericListView.RefreshList(this.categories):(this.genericListView=new c({el:"#left-panel",DisableAdd:this.options.IsReadOnly}),this.genericListView.on("search",this.SearchItem,this),this.genericListView.on("selected",this.SelectedItem,this),this.genericListView.on("add",this.AddCategory,this),this.genericListView.on("loaded",this.GetFirstItem,this),this.genericListView.collection=this.categories,this.genericListView.SetPlaceHolder("Search Categories"),this.genericListView.SetDisplayField("CategoryCode"),this.genericListView.Show())},SearchItem:function(){this.genericListView&&(1==t.FormHasChanges?navigator.notification.confirm("Do you want to cancel changes?",w,"Confirmation",["Yes","No"]):this.LoadSearchItem())},LoadSearchItem:function(){this.LoadItems(this.genericListView.GetItemToSearch()),t.FormHasChanges=!1},SelectNewlyAddedItem:function(){var e=new s;e.set(this.newModel),this.genericListView.SelectByAttribute("CategoryCode",e.get("CategoryCode")),this.LoadSelectedItem(this.newModel),this.newModel=null,this.isNewLyAdded=!1},LoadSelectedItem:function(e){if(e){var i=new s;i.set(e),this.categoryModel=i}else this.categoryModel=this.genericListView.GetSelectedModel();this.IsNullOrWhiteSpace(this.categoryDetailView)||this.categoryModel.unbind(),this.categoryDetailView=new n({el:$("#right-panel"),model:this.categoryModel,IsReadOnly:this.options.IsReadOnly}),this.categoryDetailView.BindToForm(this),this.categoryDetailView.InitializeChildViews(),t.FormHasChanges=!1},SelectedItem:function(){this.genericListView&&(1==t.FormHasChanges?navigator.notification.confirm("Do you want to cancel changes?",y,"Confirmation",["Yes","No"]):this.LoadSelectedItem())}});return L});