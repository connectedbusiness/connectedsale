define(["jquery","mobile","underscore","backbone","shared/global","shared/enum","shared/shared","text!template/19.2.0/pos/seriallot/serial/serial.tpl.html"],function(e,t,i,s,a,n,l,o){var h=s.View.extend({_template:i.template(o),tagName:"li",events:{"tap #delete-serialLot":"ProcessDelete","change #include-serialLot":"ProcessIncludeSerialLot",tap:"showEmailInput_tap"},bindEvents:function(){var t=this;this.element=e("#"+this.cid+" #input-serialEmail"),this.element.on("focusout",function(e){t.hideEmailInput_tap(e)}),this.element.on("change",function(e){t.changeEmailInput_tap(e)})},changeEmailInput_tap:function(e){e.preventDefault();var t=this.element.val().trim();l.IsNullOrWhiteSpace(t)?(this.SetEmail("Enter Email address here..."),this.element.hide(),"change"==e.type&&this.element.off("focusout")):l.ValidateEmailFormat(t)?navigator.notification.alert("The email you entered is not valid. Try again.",null,"Action not Allowed","OK"):(this.SetEmail(t),this.element.hide(),"change"==e.type&&this.element.off("focusout"))},hideEmailInput_tap:function(t){t.preventDefault(),e("#"+this.cid+" #span-serialEmail").show(),this.element.hide(),"focusout"==t.type&&this.element.off("change")},showEmailInput_tap:function(t){if(t.preventDefault(),"include-serialLot"!=t.target.id){if(a.TransactionType===n.TransactionType.Recharge||a.TransactionType===n.TransactionType.SalesRefund)return;if(e("#"+this.cid+" #span-serialEmail").hide(),this.model.get("ItemType")!=n.ItemType.GiftCard&&this.model.get("ItemType")!=n.ItemType.GiftCertificate)return;this.bindEvents(),this.element.show(),this.element.focus()}else this.ProcessIncludeSerialLot(t)},initialize:function(){this.model.on("remove",this.RemoveSerialLot,this)},render:function(){var e=!1;return this.isChecked,a.TransactionType!=n.TransactionType.SalesRefund&&this.model.get("ItemType")!=n.ItemType.GiftCard&&this.model.get("ItemType")!=n.ItemType.GiftCertificate?(this.isChecked=this.model.get("IsIncluded"),e=!1):(l.IsNullOrWhiteSpace(this.model.get("IsIncluded"))?this.isChecked=this.model.get("IsReturned"):this.isChecked=this.model.get("IsIncluded"),e=a.TransactionType!=n.TransactionType.SalesRefund),this.$el.prepend(this._template(this.model.toJSON())),this.$el.attr("id",this.cid),e||this.$("#span-serialEmail").hide(),a.TransactionType===n.TransactionType.SalesRefund&&this.DisableReturnedSerial(),this.AllowedToRemoveSerial()||this.$("#deletebtn-overlay").remove(),this},AllowedToRemoveSerial:function(e){return a.TransactionType!=n.TransactionType.Recharge&&a.TransactionType!=n.TransactionType.SalesRefund&&!this.model.get("IsSerialGenerated")},BindEmailRecipient:function(){e("#"+this.cid+" #span-serialEmail").text(this.model.get("SerialRecipient"))},Bind:function(){this.isChecked===!0?this.isChecked=!1:this.isChecked=!0,l.CustomCheckBoxChange("#"+this.cid+" #include-serialLot",this.isChecked),e("li").off("change")},DisableReturnedSerial:function(){(this.model.get("IsReturned")||this.model.get("IsActivated")||this.model.get("IsRecharged"))&&this.$el.addClass("ui-disabled")},ProcessDelete:function(e){e.stopPropagation(),a.TransactionType!=n.TransactionType.SalesRefund&&(this.model.get("IsSerialGenerated")||this.model.removeItem())},ProcessIncludeSerialLot:function(t){t.stopPropagation();var i=t.target.id,s=!1;s=e("#"+this.cid+" #"+i).hasClass("icon-check-empty")?l.CustomCheckBoxChange("#"+this.cid+" #"+i,!1):l.CustomCheckBoxChange("#"+this.cid+" #"+i,!0),s?this.model.set({IsIncluded:!0}):this.model.set({IsIncluded:!1}),"change"==t.type&&e("li").off("tap")},RemoveSerialLot:function(){this.remove(),e("#serialListNumber").listview("refresh")},SetEmail:function(t){this.model.set({OriginalSerialRecipient:this.model.get("SerialRecipient")?this.model.get("SerialRecipient"):""}),"Enter Email address here..."!=t?this.model.set({SerialRecipient:t,IsEmailModified:!0}):this.model.set({SerialRecipient:""}),e("#"+this.cid+" #span-serialEmail").show(),e("#"+this.cid+" #span-serialEmail").text(t)}});return h});