define(["jquery","shared/global","shared/enum","shared/service","shared/method","model/base","model/reportsetting","collection/base","view/spinner","js/libs/jquery.numeric.js","js/libs/datepicker.js","js/libs/moment.min.js"],function(e,t,i,n,r,o,a,s,c){var l=!1,p={CompareVersions:function(e,t){return e=this.GetVersionAttributes(e),t=this.GetVersionAttributes(t),e.Major==t.Major?e.Minor==t.Minor?e.Build==t.Build?0:e.Build>t.Build?1:2:e.Minor>t.Minor?1:2:e.Major>t.Major?1:2},CompareMajorMinorVersions:function(e,t){return e=this.GetVersionAttributes(e),t=this.GetVersionAttributes(t),e.Major==t.Major?e.Minor==t.Minor?0:e.Minor>t.Minor?1:2:e.Major>t.Major?1:2},GetSaleCreditCardTransactionType:function(){if(t.TransactionType==i.TransactionType.Sale||t.TransactionType==i.TransactionType.UpdateInvoice||t.TransactionType==i.TransactionType.ResumeSale||t.TransactionType==i.TransactionType.SalesPayment)return 1==t.AllowSaleCreditPreference?"Sale":"Auth/Capture"},GetVersionAttributes:function(e){var t={Major:0,Minor:0,Build:0,Interim:0};if(!e)return t;e+=".";for(var i=0,n="0",r="0123456789",o="",a=0;a<e.length;a++)o=e.substr(a,1),"."==o?(i+=1,1==i&&(t.Major=parseFloat(n)),2==i&&(t.Minor=parseFloat(n)),3==i&&(t.Build=parseFloat(n)),4==i&&(t.Interim=parseFloat(n)),n="0"):r.indexOf(o)>-1&&(n+=o);return t},HideActivityIndicator:function(){t.isBrowserMode||window.plugins.cbNetworkActivity.HideIndicator(),_spinner=c,_spinner.stop(),e("#spin").remove()},IsNullOrWhiteSpace:function(e){return!e||(""===e||null===e||void 0===e)},ShowHideClassTemplates:function(t){e("#"+t).hide()},ShowHideOrderNotes:function(t,i){i?e("#"+t).hide():e("#"+t).show()},ShowHideBlockOverlay:function(t){t?e("#main-transaction-blockoverlay").show():e("#main-transaction-blockoverlay").hide()},LockTransactionScreen:function(t,i){switch(t){case!0:e("#main-transaction-blockoverlay").show(),target=document.getElementById("main-transaction-page"),this.ShowActivityIndicator(target),e("<h5>"+i+"</h5>").appendTo(e("#spin"));break;default:e("#main-transaction-blockoverlay").hide(),this.HideActivityIndicator()}},ShowOverlayIfTransactionsViewIsVisible:function(){var t=e("#transactionsContainer");0!=t.length&&t.is(":visible")&&"none"!=t.css("display")&&""!=t.html().trim()&&(console.log("Force Show Overlay"),e("#main-transaction-blockoverlay").show())},ShowActivityIndicator:function(t){t||(t=document.getElementById("main-transaction-page")),e("<div id='spin'></div>").appendTo(t);var i=document.getElementById("spin");_spinner=c,_spinner.opts.color="#fff",_spinner.opts.lines=13,_spinner.opts.length=7,_spinner.opts.width=4,_spinner.opts.radius=10,_spinner.opts.top="auto",_spinner.opts.left="auto",_spinner.spin(i)},ValidateEmailFormat:function(e){var t=/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}$/i;return e.search(t)==-1},ValidateUrlFormat:function(t,i){var n=/^(www)\.[a-z0-9]+([\-\.]{1}[a-z0-9]+)*\.[a-z]{2,5}(:[0-9]{1,5})?(\/.*)?$/i;if(i){if(!t)return!1;if(0==e.trim(t).length)return!1}return t=this.TrimUrl(t),!n.test(t)},TrimUrl:function(t){return t=e.trim(t),this.HasCharacters(t,"http://")<0&&this.HasCharacters(t,"https://")<0?t:0==this.HasCharacters(t,"http://")?t.replace("http://",""):0==this.HasCharacters(t,"https://")?t.replace("https://",""):t},HasCharacters:function(e,t){return e.indexOf(t)},CreditCard:{CleanArray:function(e){for(var t=new Array,i=0;i<e.length;i++)e[i]&&t.push(e[i]);return t},ClearCreditCardInfo:function(){e("#expDate").val(""),e("#cardName").val(""),e("#track1").text(""),e("#track2").text(""),e("#ksn").text(""),e("#magnePrint").text(""),e("#magnePrintStatus").text(""),e("#cc-msg").text("Please swipe card.")},ParseCreditCardMagWithValidation:function(t,i){this.ClearCreditCardInfo(),null===t&&i===!0?navigator.notification.alert("Unable to get credit card information, please swipe the card again."):null===t&&i===!1&&navigator.notification.alert("Please enter a valid CC number.");var n=t.split("?");if(n=this.CleanArray(n),null!=n&&n.length>0){var r=n[0].split("^");if(null!=r&&r.length>0&&(e("#cardNumber").val(this.ParseCreditCardNumber(r[0])),r.length>1&&e("#cardName").val(this.ParseCreditCardName(r[1])),r.length>2&&e("#expDate").val(this.ParseExpDate(r[2])).addClass("ui-disabled"),e("#isSwiped").text(!0),i=!0),n.length>2&&this.ParseEncryptedTrack(n),""!==e("#track1").text()&&""!==e("#track2").text()||(e("#track1").text(n[0]),e("#track2").text(n[1])),""===e("#track1").text()||""===e("#track2").text()||""===e("#cardNumber").val()||""===e("#cardName").val()||""===e("#expDate").val())return i?navigator.notification.alert("Unable to get credit card information, please swipe the card again."):navigator.notification.alert("Please enter a valid CC number."),void this.ClearCreditCardInfo();e("#cc-msg").text("Successfully retrieved card information.")}return null},ParseCreditCardMag:function(t){this.ClearCreditCardInfo(),null===t&&navigator.notification.alert("Unable to get credit card information, please swipe the card again.");var i=t.split("?");if(i=this.CleanArray(i),null!=i&&i.length>0){var n=i[0].split("^");null!=n&&n.length>0&&(e("#cardNumber").val(this.ParseCreditCardNumber(n[0])),n.length>1&&e("#cardName").val(this.ParseCreditCardName(n[1])),n.length>2&&e("#expDate").val(this.ParseExpDate(n[2])).addClass("ui-disabled"),e("#isSwiped").text(!0),""!=e("#cardNumber").val()&&e("#cc-msg").text("Successfully retrieved card information.")),i.length>2&&this.ParseEncryptedTrack(i),""!==e("#track1").text()&&""!==e("#track2").text()&&""!==e("#cardNumber").val()&&""!==e("#cardName").val()&&""!==e("#expDate").val()||(navigator.notification.alert("Unable to get credit card information, please swipe the card again."),this.ClearCreditCardInfo())}return null},ParseEncryptedTrack:function(t){if(null!=t[t.length-1]&&t.length>0&&0===t[t.length-1].indexOf("|")){var i=t[t.length-1].split("|");13===i.length?(e("#track1").text(i[2]),e("#track2").text(i[3]),e("#ksn").text(i[9]),e("#magnePrint").text(i[6]),e("#magnePrintStatus").text(i[5])):12===i.length&&(e("#track1").text(i[2]),e("#track2").text(i[3]),e("#ksn").text(i[8]),e("#magnePrint").text(i[5]),e("#magnePrintStatus").text(i[4]))}},ParseCreditCardNumber:function(e){return e.replace(/[^0-9]+/,"")},ParseCreditCardName:function(e){if(null!=e&&e.indexOf("/")>=0){var t=e.split("/");if(null!=t&&t.length>0)return t[1]+" "+t[0]}return e},ParseExpDate:function(e){var t=e.substring(0,2),i=e.substring(2,4);return e="20"+t+"-"+i}},ShowNotification:function(i,n,r,a){var c;if("POS"==t.ApplicationType&&(c="#main-transaction-page"),"Settings"==t.ApplicationType&&(c="#settings-page"),"Products"==t.ApplicationType&&(c="#products-page"),"Customers"==t.ApplicationType&&(c="#customers-page"),"Secondary"==t.ApplicationType&&(c="#secondary-page"),"Reports"==t.ApplicationType&&(c="reportsForm"),c){var l=this;this.notifications||(this.notifications=new s);var p=new o;p.set({notifID:"notif"+p.cid});var u='<div id="notification-overlay" class="z3000 notification-overlay-cs14 '+p.get("notifID")+'"> <center> <div><i class="icon-ok">&nbsp; <span class="message">'+l.Escapedhtml(i||"")+"</span></i></div> </center></div>";switch(this.notifications.add(p),e(c).is(":visible")){case!0:e(c).append(u);break;case!1:e("#main-transaction-page").is(":visible")?e("#main-transaction-page").append(u):e("#settings-page").is(":visible")?e("#settings-page").append(u):e("#products-page").is(":visible")?e("#products-page").append(u):e("#customers-page").is(":visible")?e("#customers-page").append(u):e("#secondary-page").is(":visible")?e("#secondary-page").append(u):e("#reportsForm").is(":visible")&&e("#reportsForm").append(u)}var d=e("."+p.get("notifID")+" i"),f=e("."+p.get("notifID"));f.hide(),d.removeClass("icon-ok"),d.removeClass("icon-remove-sign"),d.removeClass("ok"),d.removeClass("warn"),n?(a||d.addClass("icon-remove-sign"),d.addClass("warn")):(a||d.addClass("icon-ok"),d.addClass("ok"));var g=f.height(),h=713-g;navigator.keyboardIsVisible?(f.css("top",l.GetNotificationTopPosition()+"px"),f.css("padding","10px 20px 3px")):(f.css("padding","7px 20px 7px"),f.css("top",h+"px"));var v=(1024-f.width())/2;f.css("left",v+"px"),f.fadeIn(),p.set({Top:h}),r||(r=3e3),p.removeMe=function(){clearTimeout(p.notificationTimeOut),clearInterval(p.topPositionChecking),f.fadeOut(1e3),f.remove(),p.set({Done:!0})},p.topPositionChecking=setInterval(function(){navigator.keyboardIsVisible&&l.ToggleNotificationPosition(!0)},100),p.notificationTimeOut=setTimeout(function(){p.removeMe()},r),p.age=0;var m=new Array;if(this.notifications.each(function(t){if(t.age++,t.age>(navigator.keyboardIsVisible?1:3)&&!t.get("Done")&&t.removeMe(),p.get("notifID")!=t.get("notifID"))if(t.get("Done"))m[m.length]=t;else{var i=t.get("Top")-g-20;t.set({Top:i});var n=e("."+t.get("notifID"));n.css("top",i+"px"),n.css("opacity","0.8")}}),m.length>0)for(var w in m)this.notifications.remove(m[w]);m=null}},ToggleNotificationPosition:function(t){if(this.notifications){var i=this.notifications.last();if(i&&!i.get("Done")){var n=e("."+i.get("notifID"));if(t)n.css("top",this.GetNotificationTopPosition()+"px"),n.css("padding","10px 20px 3px");else{n.css("padding","7px 20px 7px");var r=713-n.height();n.css("top",r+"px")}}}},GetNotificationTopPosition:function(){var t=document.activeElement;if(t&&("input"==t.localName||"textarea"==t.localName||"select"==t.localName)){var i=748,n=352,r=t.clientHeight,o=e(t).offset().top;if("select"==t.localName&&(r=this.notifLastHeight||0,o=this.notifLastTop||0),this.notifLastHeight=r,this.notifLastTop=o,(i-n)/2<o+r/2)return 15+(o+r/2)-(i-n)/2}return-5},ToggleDisplayAlignment:function(){if(!t.isBrowserMode)var e=0,i=setInterval(function(){return e>3?void clearInterval(i):(e++,void window.plugins.display.ToggleDisplay())},1e3)},SetFullScreen:function(e){t.isBrowserMode||(e?window.plugins.display.SetFullScreen():window.plugins.display.UnsetFullScreen())},PrintBrowserMode:{Print:function(e,i,n,o){t.isOkToOpenCashDrawer&&t.Preference.UseCashDrawer&&this.DrawerKick();var a=(document.connectedsaleprinting,t.ServiceUrl+r.REPORTS),s=a+e+".pdf";printerTool&&printerTool.printReport(s,n,o)},DrawerKick:function(){t.PreventDrawerKick?t.PreventDrawerKick=!1:t.isOkToOpenCashDrawer&&t.Preference.UseCashDrawer&&(printerTool&&printerTool.openCashDrawer(t.Preference.DefaultPrinter).then(function(){console.log("DrawerKick!")}),t.isOkToOpenCashDrawer=!1,console.log("DrawerKick!"))},ValidateApplet:function(e,t){var i=!0;return e||(i=!1),i&&(e.PrintReport&&e.DrawerKick||(i=!1)),i||navigator.notification.alert("ConnectedSale "+(t?"Cash Drawer":"Printer")+" Applet was not loaded properly, please refresh your browser or contact your administrator.",null,"Applet Error","OK",!0),i}},LoadServiceApplet:function(){if(t.isBrowserMode&&t.LastServiceURLUsed!=t.ServiceUrl){!function(){var e='<iframe id="printAppletFrame" style="position: relative; height:0; width:0;" src="'+t.ServiceUrl+"Reports/print.html?"+Math.random()+'"></iframe>';document.getElementById("csPrintingApplet-container").innerHTML=e}();var i=this;e("#printAppletFrame").off("deleteReport"),e("#printAppletFrame").on("deleteReport",function(e,t){i.Printer.DeleteReport(t.pages,t.code)});var n=new Array,r=new Array,o=function(e,t,i){return this.code=e,this.page=t,this.pages=i,this},a=function(e){var t=!1;for(var i in n)n[i].code==e.code&&n[i].page==e.page&&n[i].pages==e.pages&&(t=!0);t||(n[n.length]=new o(e.code,e.page,e.pages)),t=!1;for(var i in r)r[i]==e.code&&(t=!0);t||(r[r.length]=e.code),s()},s=function(){for(var t in r){var i=r[t],o=function(e){return e.code==i},a=function(e){return e.code!=i},s=n.filter(o);s.length>0&&s[0].pages==s.length&&(e("#printAppletFrame").trigger("deleteReport",s[0]),n=n.filter(a),r[t]="")}r=r.filter(function(e){return""!=e})},c=function(t){r=r.filter(function(e){return e!=t.code}),n=n.filter(function(e){return e.code!=t.code}),e("#printAppletFrame").trigger("deleteReport",t)},l=function(t){if(t.data){var i=t.data;if("error"==i.task)return void navigator.notification.alert(i.message,null,"Applet Error","OK",!0);if("loaded"==i.task)return void e("#applet-bar").css("display","none");if("loading"==i.task)return e("#loading-applet").html("Loading Applet . . ."),void e("#applet-bar i").on("click",function(){e("#applet-bar").hide(),document.getElementById("printAppletFrame").contentWindow.postMessage({task:"cancel"},"*")});if("response"==i.task){if(!i.response)return;return void("print"==i.response.type&&("success"==i.response.status&&a(i.response.data),"error"==i.response.status&&c(i.response.data)))}}};t.LastServiceURLUsed||window.addEventListener("message",l),t.LastServiceURLUsed=t.ServiceUrl,setTimeout(function(){document.getElementById("printAppletFrame").contentWindow.postMessage({task:"init"},"*")},1e3)}},LoadApplet:function(){var t=function(){var e='<applet id="connectedsaleprinting" code="connectedsaleprinting.ConnectedSalePrinting" archive="js/libs/ConnectedSalePrinting.jar?'+Math.random()+'" height="0px" width="0px" style="position: absolute"></applet>';document.getElementById("csPrintingApplet-container").innerHTML=e};t();var i=" ",n=!1,r=function(t){var r=!0;if(t||(r=!1),r&&(t.PrintReport&&t.DrawerKick||(r=!1)),r)clearInterval(o),e("#applet-bar").css("display","none"),console.log("ConnectedSale (Applet Loaded!)");else{switch(i){case". ":i=". . ";break;case". . ":i=". . . ";break;case". . . ":i=" ";break;case" ":i=". "}e("#applet-bar").css("display","block"),e("#loading-applet").html("Loading Applet "+i),console.log("ConnectedSale ( Loading Applet... )"),n||(n=!0,e("#applet-bar i").on("click",function(){clearInterval(o),e("#applet-bar").css("display","none")}))}return r},o=setInterval(function(){r(document.connectedsaleprinting)||t()},3e3)},Printer:{LoadScroll:function(e,t,i){e=new iScroll(t,i),this.RefreshMyScroll(e,t,i)},RefreshMyScroll:function(e,t,i){setTimeout(function(){e=new iScroll(t,i),e.refresh()},500)},InitializePrintPlugin:function(){window.plugins?window.plugins.cbReceiptPrint=cordova.require(t.Plugins.ReceiptPrinter):window.plugins={}},InitializePrintPluginArray:function(){window.plugins.cbReceiptPrint.InitializeArray()},Validate:function(e,i){return""!=e&&""!=i&&"Printer model not supported"!=i&&"No Printer Model specified"!=i?(t.isBrowserMode||t.isPrinterInitialized&&t.isPrinterInitialized!==!1||window.plugins.cbReceiptPrint.InitializeBuilder(i,function(e){t.isPrinterInitialized=e}),!0):(t.isPrinterInitialized=!1,!1)},OpenPrinter:function(e){window.plugins.cbReceiptPrint.OpenPrinter(e,function(e){t.Printer.isPrinterOpen=e,console.log("ISOPEN: "+t.Printer.isPrinterOpen)},function(e){switch(t.Printer.isPrinterOpen=!1,e){case"Connection failed":navigator.notification.alert("It appears that you're currently not connected to any printer. Please turn on the printer and try again...",null,e,"OK",!0);break;case"Connection is still open":navigator.notification.alert("You are connected to the printer as of the moment.",null,e,"OK",!0)}})},DrawerKick:function(e,i){!t.Preference.UseCashDrawer},ClosePrinter:function(){window.plugins.cbReceiptPrint.ClosePrinter("closePrinter",function(e){t.Printer.isPrinterOpen=e,console.log("ISOPEN: "+t.Printer.IsPrinterOpen)})},PrintReceipt:function(){var e=!1,i=!1,n=p.GetVersionAttributes(t.ServerVersion).Major<14;console.log("IsVersionBelow14 : "+n),t.PrintOptions.Reprint?t.PrintOptions.Reprint=!1:((t.Preference.AutoPrintReceipt&&t.PrintOptions.SilentPrint||t.PrintOptions.SilentPrint)&&(e=t.Preference.UseCashDrawer,i=!0),n&&(e=t.Preference.UseCashDrawer),t.isOkToOpenCashDrawer&&!t.isReturnTransaction||(e=!1)),window.plugins.cbReceiptPrint.PrintReceipt(e.toString(),i.toString(),function(e){},function(e){console.log("Unable to Print: "+e),navigator.notification.alert("Unable to print receipt. Please try again.",null,"Unable to Print","OK",!0)})},ReleasePrinterObjects:function(){window.plugins.cbReceiptPrint.ReleaseObjects("release")},DeleteReport:function(e,i){if(!l&&(p.LockTransactionScreen(!1),p.ShowOverlayIfTransactionsViewIsVisible(),0===e&&(e=1),t.Printer.SelectedPrinter="",!t.isBrowserMode||"Reports"!=t.ApplicationType||!t.Printer.isPrintedinPrinter)){var o=new a,s=!1,c=t.Preference.AutoPrintReceipt&&t.PrintOptions.SilentPrint||t.PrintOptions.SilentPrint;s=!c&&t.isBrowserMode,o.url=t.ServiceUrl+n.POS+r.DELETEREPORT+i+"/"+e+"/"+s,o.save(null,{success:function(e,i){t.isBrowserMode||window.plugins.cbNetworkActivity.HideIndicator()},error:function(e,i,n){t.isBrowserMode||window.plugins.cbNetworkActivity.HideIndicator()}}),this.DeletePaymentReport(i)}},DeletePaymentReport:function(e){var i=new o;i.url=t.ServiceUrl+n.SOP+"deletepaymentreport/"+e,i.save()},LoadAirPrintPlugin:function(){t.PrintPluginLoaded||(window.plugins?window.plugins.printPlugin=cordova.require(t.Plugins.AirPrinter):window.plugins={})},PrintAirPrintReceipt:function(e,i){var n=87;0==!i.top&&(n=i.top),window.plugins.printPlugin.print(e,function(e){t.PrintOptions.Reprint=!1,t.PrintPluginLoaded=!1},function(e){e?navigator.notification.alert(e.error,null,"Printing Failed","OK"):navigator.notification.alert("Printing is not available.",null,"Printing Failed","OK",!0),t.PrintPluginLoaded=!1},{dialogOffset:{left:860,top:n}})},SetReceiptPrintImage:function(e){window.plugins.cbReceiptPrint.SetImageURL(e)},SearchPrinter:function(i){t.isBrowserMode?e("#printer-address").trigger("change"):(window.plugins.cbReceiptPrint.SearchPrinter(),e(i+" span").text("Searching for Printers within the network..."))},ConnectionTest:function(i,n){var r="";window.plugins.cbReceiptPrint.ConnectionTest(i,n,function(i){r="Connection test is successful.",navigator.notification.alert(r,null,i,"OK",!0),e("#printer-status span").text(r),t.isPrinterInitialized=!1},function(t){switch(t){case"Connection failed":r="It appears that you're currently not connected to any printer. Please turn on the printer and try again...";break;case"Connection is still open":r="You are connected to the printer as of the moment.";break;case"IP Address empty":r="Please Specify the IP Address of the Printer and Try again..."}e("#printer-status span").text(r),navigator.notification.alert(r,null,t,"OK",!0)})}},LoadPostalByCode:function(e,i,a){var s=new o;s.set({StringValue:e}),s.url=t.ServiceUrl+n.CUSTOMER+r.LOADPOSTALBYCRITERIA,s.save(s,{success:function(e,n,r){t.isBrowserMode||window.plugins.cbNetworkActivity.HideIndicator(),i&&i(e.get("Postals")),console.log("Success - Postals")},error:function(e,i,n){t.isBrowserMode||window.plugins.cbNetworkActivity.HideIndicator(),a&&a(i),console.log("Error - Postals")}})},Escapedhtml:function(e){var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};return String(e).replace(/[&<>"'\/]/g,function(e){return t[e]})},EscapedModel:function(e){var t=new o;if(e){t.set(e.attributes);for(attr in t.attributes){var i=t.attributes[attr];("string"==typeof i||i instanceof String)&&(i=this.Escapedhtml(i)),t.attributes[attr]=i}}return t},POS:{Overlay:{Show:function(){e("#main-transaction-blockoverlay").show()},Hide:function(){e("#main-transaction-blockoverlay").hide(),t.isBrowserMode||window.plugins.cbNetworkActivity.HideIndicator()}}},Products:{Overlay:{Show:function(t){t&&(e("#overlay-message").text(t),e(".overlay-message-container").show()),e("#products-page-blockoverlay").css("display","block")},Hide:function(){e("#products-page-blockoverlay").css("display","none"),e(".overlay-message-container").hide(),t.isBrowserMode||window.plugins.cbNetworkActivity.HideIndicator()}},DisplayWait:function(t){e(t).html('<center><div class="loading"><i class="icon-spinner icon-spin"></i></div></center>')},DisplayError:function(i){e(i).html('<center><div class="loading"><i class="icon-warning-sign"></i></div></center>'),t.isBrowserMode||window.plugins.cbNetworkActivity.HideIndicator()},DisplayNoRecordFound:function(t,i,n){var r="";r=n.length>0?"Sorry, your search for <span>"+n+"</span> &nbsp; did not match any records.":"Sorry, there are no records yet",e(t).html('<center><div class="norecord"><i class="icon-ban-circle"></i><br><p>No Record Found</p></div></center>'),e(i).html('<div class="norecordlist"><p>'+r+"</p></div>")},ShowNotification:function(t,i,n){if(navigator.notification.isOverrideAlert)return void p.ShowNotification(t,i,n);this._nofificationTimeOut&&clearTimeout(this._nofificationTimeOut),e("#notification-overlay").hide(),e("#notification-overlay .message").html(t),e("#notification-overlay i").removeClass("icon-ok"),e("#notification-overlay i").removeClass("icon-remove-sign"),e("#notification-overlay i").removeClass("ok"),e("#notification-overlay i").removeClass("warn"),i?(e("#notification-overlay i").addClass("icon-remove-sign"),e("#notification-overlay i").addClass("warn")):(e("#notification-overlay i").addClass("icon-ok"),e("#notification-overlay i").addClass("ok"));var r=(1024-e("#notification-overlay").width())/2;e("#notification-overlay").css("left",r+"px"),e("#notification-overlay").fadeIn(),n||(n=3e3),this._nofificationTimeOut=setTimeout(function(){e("#notification-overlay").fadeOut(1e3)},n)},RequestTimeOut:function(e){t.isBrowserMode||window.plugins.cbNetworkActivity.HideIndicator(),e||(e="Request Time out."),this.ShowNotification(e,!0),this.Overlay.Hide()},ByteToBase64:function(e){for(var t="",i="",n=0;n<e.length;n++)i+=String.fromCharCode(e[n]),57==i.length&&n!=e.length-1&&(t+=btoa(i)+"\n",i="");return t+btoa(i)},Base64Only:function(e){if(e)return e=e.replace("data:image/png;base64,",""),e=e.replace("data:image/jpeg;base64,","")},NumberWithCommas:function(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}},Customers:{Overlay:{Show:function(){e("#customers-page-blockoverlay").css("display","block")},Hide:function(){e("#customers-page-blockoverlay").css("display","none"),t.isBrowserMode||window.plugins.cbNetworkActivity.HideIndicator()}},ShowNotification:function(t,i,n){if(navigator.notification.isOverrideAlert)return void p.ShowNotification(t,i,n);this._nofificationTimeOut&&clearTimeout(this._nofificationTimeOut),e("#notification-overlay").hide(),e("#notification-overlay .message").html(t),e("#notification-overlay i").removeClass("icon-ok"),e("#notification-overlay i").removeClass("icon-remove-sign"),e("#notification-overlay i").removeClass("ok"),e("#notification-overlay i").removeClass("warn"),i?(e("#notification-overlay i").addClass("icon-remove-sign"),e("#notification-overlay i").addClass("warn")):(e("#notification-overlay i").addClass("icon-ok"),e("#notification-overlay i").addClass("ok"));var r=(1024-e("#notification-overlay").width())/2;e("#notification-overlay").css("left",r+"px"),e("#notification-overlay").fadeIn(),n||(n=3e3),this._nofificationTimeOut=setTimeout(function(){e("#notification-overlay").fadeOut(1e3)},n)}},GetJsonUTCDate:function(){var e=new Date,t=e.getMonth(),i=e.getDate(),n=e.getFullYear();return e=Date.UTC(n,t,i),e="/Date("+e+")/"},Focus:function(i){t.isBrowserMode&&e(i).focus(),e(i).addClass("ui-focus")},Input:{Numeric:function(t){try{e(t).numeric()}catch(i){console.log("numeric didn't load properly.")}},NonNegative:function(t){try{e(t).numeric({negative:!1,allow:"."})}catch(i){console.log("numeric didn't load properly.")}},Integer:function(t){try{e(t).numeric({decimal:!1})}catch(i){console.log("numeric didn't load properly.")}},NonNegativeInteger:function(t){try{e(t).numeric({decimal:!1,negative:!1})}catch(i){console.log("numeric didn't load properly.")}}},ApplyAllowedDecimalFormat:function(e){var t=parseFloat(e);return NaN===t?e:t%1==0?t:parseFloat(t.toFixed(2))},MaxDecimalPlaceValidation:function(e,t,i){myInputElement=e;var n=0;if(n=i?this.GetCaretPosition(i+" #"+t.target.id):this.GetCaretPosition("#"+t.target.id),37==t.keyCode||39==t.keyCode||13==t.keyCode)return!0;var r=myInputElement.val();r||(r="");var o=2,a=(r.split(".")[0],r.split(".")[1]);return a||(a=""),console.log("pos:"+n+" length:"+r.length),a.length!=o||!(n>r.length-3||n>r.length)||(t.preventDefault(),!1)},GetCaretPosition:function(t){return t?"INPUT"!=e(t)[0].tagName?0:e(t).__proto__.getSelectionStart(e(t)[0]):(console.log("no element selected."),0)},TrimDefaultShipTo:function(){var e=this.Escapedhtml(t.DefaultShipTo);return t.DefaultShipTo.length>=65?e=this.Escapedhtml(t.DefaultShipTo.substring(0,71)+"..."):e},TrimCustomerName:function(){var e=this.Escapedhtml(t.CustomerName);if(null!=t.CustomerName)return t.CustomerName.length>=20?e=this.Escapedhtml(t.CustomerName.substring(0,16)+"..."):e},TrimSalesRepName:function(){var i=this.Escapedhtml(t.SalesRepGroupName);return null!=t.SalesRepGroupName&&""!=t.SalesRepGroupName?t.SalesRepGroupName.length>=14?i=this.Escapedhtml(t.SalesRepGroupName.substring(0,17)+"..."):i:(e("#lbl-salesrepName").width("27%"),i="")},TrimCommissionPercent:function(){var i=this.Escapedhtml(t.RepSplit);return null!=t.RepSplit&&""!=t.SalesRepGroupName?t.RepSplit.length>=6?i=this.Escapedhtml(t.RepSplit.substring(0,3)+"..."):i+"%":(e("#splitrateName").width("30%"),i="0%")},BrowserModeDatePicker:function(i,n,r,o,a){if(t.isBrowserMode){e(i).attr("readonly","readonly"),e(i).prop("type","text");var s=r;this.IsNullOrWhiteSpace(r)?this.IsNullOrWhiteSpace(o)?(e(i).datepicker({changeMonth:!0,changeYear:!0,showButtonPanel:!0,dateFortmat:"mm/dd/yyyy",closeText:"Clear"}),e("button.ui-datepicker-current").live("click",function(){e.datepicker._curInst.input.datepicker("setDate",new Date).datepicker("hide")}),e(".ui-datepicker-close").live("click",function(t){t.stopImmediatePropagation(),e(i).val(""),e(i).trigger("change"),e(i).blur()})):e(i).datepicker({changeMonth:!0,changeYear:!0,showButtonPanel:!0,dateFortmat:"mm/dd/yyyy"}):e(i).datepicker({changeMonth:!0,changeYear:!0,showButtonPanel:!0,dateFormat:s,onClose:function(t,n){var r=e("#ui-datepicker-div .ui-datepicker-month :selected").val(),o=e("#ui-datepicker-div .ui-datepicker-year :selected").val(),a=1;switch(s){case"yy-mm":a=1;break;case"yy-mm-dd":a=n.selectedDay}console.log("Format 2: "+s+" Date: "+o+"-"+r+"-"+a),e(this).datepicker("setDate",new Date(o,r,a)),e(i).blur()}}),this.IsNullOrWhiteSpace(s)||"yy-mm"!=s||(e(i).focus(function(){e(".ui-datepicker-calendar").hide(),e("#ui-datepicker-div").position({my:"center top",at:"center bottom",of:e(this)})}),e(i).blur(function(){e(".ui-datepicker-calendar").hide(),e("#ui-datepicker-div").position({my:"center top",at:"center bottom",of:e(this)})}))}else this.SetDefaultToday(i,r)},SetDefaultToday:function(t,i){i=this.IsNullOrWhiteSpace(i)?"YYYY-MM-DD":"YYYY-MM",e(t).val(moment().format(i))},IsNullOrWhiteSpace:function(t){return!t||(null===t||void 0===t||""===e.trim(t))},CustomCheckBoxChange:function(t,i){return i=i!==!0,1==i?(e(t).removeClass("icon-check-empty"),e(t).addClass("icon-check")):(e(t).removeClass("icon-check"),e(t).addClass("icon-check-empty")),i},GetWebsiteCode:function(){return t.Preference.IsUseISEImage?t.Preference.WebSiteCode:""},UseBrowserScroll:function(t,i){t?e(t).css("overflow-y","auto"):navigator.notification.alert("No element specified.",null,"UseBrowserScroll"),i?e(t).css("overflow-x","auto"):e(t).css("overflow-x","hidden")},ApplyListScroll:function(i){t.isBrowserMode&&(i?e(i).addClass("scroll-wrapper"):e("#scroll-wrapper").addClass("scroll-wrapper"),e("#right-pane-content").css({padding:"0 0 10px","overflow-x":"hidden"}))},FixRightPanelPadding:function(){t.isBrowserMode&&e("#right-pane-content").css("padding","0 30px 10px")},FocusToItemScan:function(){t.isBrowserMode&&(e("#item-wrapper #searchContainer #search-input").focus(),e("#kiosk-search-input").focus())},BlurItemScan:function(){t.isBrowserMode&&(e("#item-wrapper #searchContainer #search-input").blur(),e("#kiosk-search-input").blur())},NMIPaymentGateway:{ActivateUnimag:function(e,i){window.plugins?window.plugins.cbUnimag=cordova.require(t.Plugins.NMIPaymentGateway):window.plugins={},window.plugins.cbUnimag.ActivateUnimag(e,i,"window.plugins.cbUnimag","string")},DeactivateUnimag:function(){window.plugins.cbUnimag.DeactivateUnimag()},isConnected:function(){var t=function(t){console.log("ISCONNECTED : "+t),e("#isUnimag").text(t)};window.plugins.cbUnimag.isConnected(t)},RequestSwipe:function(t,i){var i=function(t){e("#cc-msg").text(t),e("#cc-msg").change()};window.plugins.cbUnimag.RequestSwipe(null,i)}},AdjustPhasedOutItem:function(e,n,r){if(t.TransactionType==i.TransactionType.Quote)return!1;if("P"==!e.get("Status"))return!1;var o=e.get("ItemCode"),a=parseInt(e.get("FreeStock")),c=0,l=new s;r.each(function(e){e.get("ItemCode")==o&&l.add(e)});var p=new s;if(l.length>0){for(var u=0,d=0,f=0;f<=l.length-1;f++)d=l.at(f).get("QuantityOrdered")*l.at(f).get("UnitMeasureQty"),c+=d,u+d>a?p.add(l.at(f)):u=c;if(p.each(function(e){var t=e.get("QuantityOrdered")*e.get("UnitMeasureQty"),i=a-u,n=0;t>=i&&(n=i/e.get("UnitMeasureQty"),e.set({QuantityOrdered:parseInt(n),IsQtyOrderedAdjusted:!0}),u=i)}),p.length>0)return!0}return!1},CheckIfItemIsPhaseout:function(e,n,r,o,a,c){if(t.TransactionType==i.TransactionType.Quote)return!1;if("P"==e.get("Status")){if(t.TransactionType==i.TransactionType.Return||t.TransactionType==i.TransactionType.SalesRefund)return navigator.notification.alert("This item is already phased out.",null,"Phased Out Item","OK"),!1;var l=e.get("ItemCode"),p=parseInt(e.get("FreeStock")),u=0,d=new s;if(a.each(function(e){e.get("ItemCode")===l&&d.add(e)}),d.length>0&&(d.length>1||!this.IsNullOrWhiteSpace(o))){var f=n*e.get("UnitMeasureQty");(this.IsNullOrWhiteSpace(o)||r>0)&&(f=r*e.get("UnitMeasureQty"));for(var g=0;g<=d.length-1;g++)u+=d.at(g).get("QuantityOrdered")*d.at(g).get("UnitMeasureQty");var h=u+f;if(console.log("StockToConsume: "+h+" ,ConsumedStock : "+u),h>p)return!this.IsNullOrWhiteSpace(c)||(navigator.notification.alert("This item is already phased out. The quantity must be lower than or equal the freestock",null,"Action Not Allowed","OK"),!0)}var v=e.get("FreeStock"),m=e.get("UnitMeasureQty"),w=e.get("OriginalQuantityAllocated"),y=parseInt(v),P=parseInt(n)*m,S=w+y;if(S-P<0)return!this.IsNullOrWhiteSpace(c)||(console.log("This item is already phased out. The quantity must be lower than or equal the freestock"),navigator.notification.alert("This item is already phased out. The quantity must be lower than or equal the freestock",null,"Action Not Allowed","OK"),!0)}return!1},SerialNumbers:{GenerateGiftSerialNumber:function(e,a,c,l,p){var u=new o;t.TransactionObject?(t.TransactionType===i.TransactionType.ConvertOrder&&(t.TransactionObject.InvoiceCode="[To be generated]",p||e.set({QuantityShipped:e.get("QuantityOrdered")})),u.set(t.TransactionObject)):u.set({BillToCode:t.CustomerCode,POSWorkstationID:t.POSWorkstationID,POSClerkID:t.Username,IsFreightOverwrite:!0,IsOverrideSalesRep:t.Preference.IsOverrideSalesRep,IsTaxByLocation:t.Preference.TaxByLocation,WarehouseCode:t.Preference.DefaultLocation,InvoiceCode:"[To be generated]"});var d=new s;d.add(u);var f=new s;p?(e.each(function(e){e.set({QuantityShipped:e.get("QuantityOrdered"),InvoiceCode:u.get("InvoiceCode")})}),f.reset(e.models)):f.add(e.set({InvoiceCode:u.get("InvoiceCode")}));var g=(new s,new o);g.url=t.ServiceUrl+n.SOP+r.GENERATEGIFTCARDSERIALNUMBER,g.set({Invoices:d.toJSON(),InvoiceDetails:f.toJSON(),SerialLotNumbers:a.toJSON()}),g.save(g,{timeout:0,success:function(e,t,i){c(e,t,i)},error:function(e,t,i){l(e,t,i)}})},GetSerialLotNumberDuplicate:function(e,i,a,s,c){var l=new o;l.url=t.ServiceUrl+n.SOP+r.GETSERIALLOTNUMBERDUPLICATES+e+"/"+i+"/"+a,l.fetch({success:function(e,t,n){n={serialLotNumber:i},s(e,t,n)},error:function(e,t,i){c(e,t,i)}})},FindItem:function(e,t,i){try{if(e instanceof s){var n=e.find(function(e){return e.get(t)===i});return p.IsNullOrWhiteSpace(n)?null:n}}catch(r){navigator.notification.alert(r.message,null,r.name,"OK")}}},Reporting:{GetReportCriterias:function(e,i,a){var c=new o,l=new s;c.set({StringValue:i,ReportCode:a}),c.url=t.ServiceUrl+n.POS+r.REPORTFILTERCRITERIA,c.save(null,{success:function(i,n){t.isBrowserMode||window.plugins.cbNetworkActivity.HideIndicator(),l.reset(n.ReportViews),e(l)}})},GetReportSubCategory:function(e,i){var a=new s;a.reset();var c=new o;c.set({ReportCode:i}),c.url=t.ServiceUrl+n.POS+r.REPORTSUBCATEGORYLOOKUP,c.save(null,{
success:function(i,n){t.isBrowserMode||window.plugins.cbNetworkActivity.HideIndicator(),a.reset(n.ReportViews),e(a)}})},AssignPOSWorkstationID:function(e,i){if(i.length>0){var n=i.find(function(e){return"POSWORKSTATIONID"==e.get("ColumnName").toUpperCase()||"@POSWORKSTATIONID"==e.get("ColumnName").toUpperCase()});if(n){var r=t.POSWorkstationID;if(e.length>0)for(var o=0;o<e.length;o++)"[WorkstationID]"==e.models[o].attributes.Name&&(r=e.models[o].attributes.Value);e.add([{Name:"POSWorkstationID",Value:r}])}}},AssignWorkstationID:function(e,i){if(i.length>0){var n=i.find(function(e){return"WORKSTATIONID"==e.get("ColumnName").toUpperCase()||"@WORKSTATIONID"==e.get("ColumnName").toUpperCase()});n&&e.add([{Name:"WorkstationID",Value:t.POSWorkstationID}])}}},SetStyle:function(t,i,n){var r="string"==typeof t?e(t):t,o=r.attr("style")||"",a=o.split(";"),s=[];for(x in a)a[x]=(a[x]||"").trim(),""!=a[x]&&a[x].split(":")[0].trim()!=i&&s.push(" "+a[x]);s.push(i+":"+n),r.attr("style",s.join(";"))},StorePickup:{StartChecker:function(e){navigator.storePickupChecker&&clearInterval(navigator.storePickupChecker);var i=function(e,t){t.ErrorMessage&&console.log(t.ErrorMessage),e.trigger("notify",{Value:t.Value?t.Value:0,Forced:e.get("IsForceNotify")})},r=function(e,t,i){console.log("Error Fetching Web Order Count.")},o=function(o){e.set({IsForceNotify:o}),e.url=t.ServiceUrl+n.SOP+"getstorepickupordercountperlocation?warehouseCode="+t.Preference.DefaultLocation,e.fetch({success:i,error:r}),console.log("Fetching Data...")};e.off("force-notify").on("force-notify",function(){o(!0)}),o();var a=parseInt(t.Preference.NotificationInterval||0);a=a<t.MinimumNotificationInterval?t.MinimumNotificationInterval:a,a=6e4*a,navigator.__proto__.storePickupChecker=setInterval(o,a)},StopChecker:function(){console.log("STOP STOREPICKUP"),navigator.storePickupChecker&&clearInterval(navigator.storePickupChecker)}},CheckSalesRep:function(e){if(t.IsOverrideSalesRep){var i=_.find(t.SalesRepUserAccount,function(e){return e.UserName==t.UserInfo.UserCode});null!=i?(t.SalesRepGroupCode=i.SalesRepGroupCode,t.SalesRepGroupName=i.SalesRepGroupName,t.RepSplit=null!=i.SalesRepGroupName?100:0):(t.SalesRepGroupCode="",t.SalesRepGroupName="",t.RepSplit=0)}else null!=e?(t.SalesRepGroupCode=e.SalesRepGroupCode,t.SalesRepGroupName=e.SalesRepGroupName,t.RepSplit=null!=e.SalesRepGroupName?100:0):(t.SalesRepGroupCode="",t.SalesRepGroupName="",t.RepSplit=0)},GetUrlFromParent:function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t="[\\?&]"+e+"=([^&#]*)",i=new RegExp(t),n=i.exec(parent.location.href);return null==n?"":n[1]}};return p});